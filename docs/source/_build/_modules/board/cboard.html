<!DOCTYPE html>
<html class="writer-html5" lang="ja" >
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>board.cboard &mdash; GridBoard 0.7 ドキュメント</title>
      <link rel="stylesheet" href="../../_static/pygments.css" type="text/css" />
      <link rel="stylesheet" href="../../_static/css/theme.css" type="text/css" />
  <!--[if lt IE 9]>
    <script src="../../_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
        <script data-url_root="../../" id="documentation_options" src="../../_static/documentation_options.js"></script>
        <script src="../../_static/jquery.js"></script>
        <script src="../../_static/underscore.js"></script>
        <script src="../../_static/doctools.js"></script>
        <script src="../../_static/translations.js"></script>
    <script src="../../_static/js/theme.js"></script>
    <link rel="index" title="索引" href="../../genindex.html" />
    <link rel="search" title="検索" href="../../search.html" /> 
</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
            <a href="../../index.html" class="icon icon-home"> GridBoard
          </a>
              <div class="version">
                v2
              </div>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <p class="caption" role="heading"><span class="caption-text">Contents:</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../board.html">board package</a></li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../../index.html">GridBoard</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="../../index.html" class="icon icon-home"></a> &raquo;</li>
          <li><a href="../index.html">モジュールコード</a> &raquo;</li>
      <li>board.cboard</li>
      <li class="wy-breadcrumbs-aside">
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <h1>board.cboard のソースコード</h1><div class="highlight"><pre>
<span></span><span class="c1"># coding: utf_8</span>
<span class="c1"># 画盤モジュール</span>
<span class="c1"># cboard.py</span>
<span class="sd">&quot;&quot;&quot;画盤モジュール</span>

<span class="sd">* 画盤システムの実装モジュール．</span>
<span class="sd">* 220815: Created by Hiroki Arimura, arim@ist.hokudai.ac.jp </span>
<span class="sd">* based on board.py </span>

<span class="sd">Attributes: </span>

<span class="sd">DEFAULT_PPT = 720 (int): デフォールトの解像度</span>
<span class="sd">DEFAULT_LINE_WIDTH = 1 (float): デフォールトの辺幅</span>
<span class="sd">DEFAULT_COLOR_BORDER_INNER = &#39;red&#39; (str): デフォールトの境界色（内側）</span>
<span class="sd">DEFAULT_COLOR_BORDER_OUTER = &#39;blue&#39; (str): デフォールトの境界色（外側）</span>
<span class="sd">&quot;&quot;&quot;</span>
<span class="kn">import</span> <span class="nn">sys</span>
<span class="kn">import</span> <span class="nn">math</span> 
<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="kn">import</span> <span class="nn">random</span> 
<span class="kn">import</span> <span class="nn">copy</span> 
<span class="kn">import</span> <span class="nn">inspect</span>
<span class="kn">import</span> <span class="nn">cairo</span> 
<span class="kn">from</span> <span class="nn">typing</span> <span class="kn">import</span> <span class="n">NamedTuple</span>

<span class="kn">import</span> <span class="nn">common</span> <span class="k">as</span> <span class="nn">com</span>
<span class="kn">import</span> <span class="nn">kwargs</span> <span class="k">as</span> <span class="nn">kw</span>
<span class="kn">import</span> <span class="nn">crtool</span> <span class="k">as</span> <span class="nn">crt</span>
<span class="kn">import</span> <span class="nn">loggable</span> <span class="k">as</span> <span class="nn">log</span> 
<span class="kn">import</span> <span class="nn">backupcaller</span> <span class="k">as</span> <span class="nn">bc</span>

<span class="c1"># DEFAULT_PPI = 720 </span>
<span class="c1"># DEFAULT_LINE_WIDTH = 1 </span>
<span class="c1"># DEFAULT_COLOR_BORDER_INNER = &#39;red&#39;</span>
<span class="c1"># DEFAULT_COLOR_BORDER_OUTER = &#39;blue&#39;</span>
<span class="c1"># EMPTY_RECT = ((0,0), (0,0))</span>

<span class="c1">## PARAMS 2022 version</span>
<span class="n">EMPTY_RECT</span> <span class="o">=</span> <span class="p">(</span><span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">)</span>
<span class="n">MYCOLS</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">crt</span><span class="o">.</span><span class="n">DARKCOL</span><span class="o">.</span><span class="n">values</span><span class="p">())</span>
<span class="c1">#MYCOLS = list(crt.MYCOL.values())</span>
<span class="n">DEFAULT_LINE_WIDTH</span><span class="o">=</span><span class="mi">1</span>

<span class="c1"># 辞書（語彙）</span>

<span class="c1">## 画像サイズ</span>
<span class="n">DISPLAY_SHAPE</span> <span class="o">=</span> <span class="p">{</span>
    <span class="s1">&#39;QVGA&#39;</span><span class="p">:</span> <span class="p">(</span><span class="mi">320</span><span class="p">,</span> <span class="mi">240</span><span class="p">),</span>
    <span class="s1">&#39;VGA&#39;</span> <span class="p">:</span> <span class="p">(</span><span class="mi">640</span><span class="p">,</span> <span class="mi">480</span><span class="p">),</span> 
    <span class="s1">&#39;SVGA&#39;</span><span class="p">:</span> <span class="p">(</span><span class="mi">800</span><span class="p">,</span> <span class="mi">600</span><span class="p">),</span> 
    <span class="s1">&#39;XGA&#39;</span> <span class="p">:</span> <span class="p">(</span><span class="mi">1024</span><span class="p">,</span> <span class="mi">768</span><span class="p">),</span> <span class="c1">#default size</span>
    <span class="s1">&#39;WXGA&#39;</span><span class="p">:</span> <span class="p">(</span><span class="mi">1280</span><span class="p">,</span> <span class="mi">800</span><span class="p">),</span> 
    <span class="s1">&#39;UXGA&#39;</span><span class="p">:</span> <span class="p">(</span><span class="mi">1600</span><span class="p">,</span> <span class="mi">1200</span><span class="p">),</span> 
    <span class="s1">&#39;QXGA&#39;</span><span class="p">:</span> <span class="p">(</span><span class="mi">2048</span><span class="p">,</span> <span class="mi">1536</span><span class="p">),</span>
<span class="p">}</span>
<span class="n">DEFAULT_IMAGE_SIZE</span><span class="o">=</span><span class="s1">&#39;XGA&#39;</span>

<span class="c1"># #constants</span>
<span class="c1"># CMD_MOVE = 0</span>
<span class="c1"># CMD_LINE = 1</span>

<div class="viewcode-block" id="perturb_point"><a class="viewcode-back" href="../../board.html#board.cboard.perturb_point">[ドキュメント]</a><span class="k">def</span> <span class="nf">perturb_point</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="mf">0.0</span><span class="p">,</span> <span class="n">y</span><span class="o">=</span><span class="mf">0.0</span><span class="p">,</span> <span class="n">max_perturb</span><span class="o">=</span><span class="mf">0.0</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;与えられた点 (x, y) に対して，幅</span>
<span class="sd">    [(-1)*max_perturb, (+1)*max_perturb] </span>
<span class="sd">    の摂動を与えた点(x1, y1)を返す．</span>
<span class="sd">    Args: </span>
<span class="sd">      x, y (float) : 入力点のx- and y-coordinates．デフォールト値 x = y = 0.0</span>

<span class="sd">    Returns: </span>
<span class="sd">         x1, y1 (float) : 摂動を加えた点のx- and y-coordinates</span>

<span class="sd">    Notes: </span>
<span class="sd">         xとyが省略されたときは，値0.0, 0.0を中心とした摂動を返す．</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="n">max_perturb</span><span class="o">==</span><span class="mf">0.0</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;warning: cboard.perturb_point: max_perturb==0.0!&#39;</span><span class="p">)</span>
    <span class="n">x1</span> <span class="o">=</span> <span class="n">x</span> <span class="o">+</span> <span class="n">max_perturb</span><span class="o">*</span><span class="n">random</span><span class="o">.</span><span class="n">random</span><span class="p">()</span>
    <span class="n">y1</span> <span class="o">=</span> <span class="n">y</span> <span class="o">+</span> <span class="n">max_perturb</span><span class="o">*</span><span class="n">random</span><span class="o">.</span><span class="n">random</span><span class="p">()</span>
    <span class="k">return</span> <span class="n">x1</span><span class="p">,</span> <span class="n">y1</span></div>


<span class="c1">#=====</span>
<span class="c1"># 画盤（board）のクラス: 座標系オブジェクト</span>
<span class="c1">#=====</span>
<span class="c1"># class Board(com.Loggable):</span>
<div class="viewcode-block" id="BoardBase"><a class="viewcode-back" href="../../board.html#board.cboard.BoardBase">[ドキュメント]</a><span class="k">class</span> <span class="nc">BoardBase</span><span class="p">(</span><span class="n">log</span><span class="o">.</span><span class="n">Loggable</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;画盤（board）のクラス: 座標系オブジェクト</span>

<span class="sd">    Args: </span>
<span class="sd">         **kwargs : 他のキーワード引数．上位クラスに渡される．</span>

<span class="sd">    Attributes: </span>
<span class="sd">         verbose (bool): ログ出力のフラグ</span>

<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">count</span> <span class="o">=</span> <span class="mi">0</span> <span class="c1">#board id</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;画盤オブジェクトを初期化する</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1">#引数</span>
        <span class="c1">#親Loggableの初期化</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
        
        <span class="c1">#内部変数</span>
        
        
        <span class="c1">##自身の配置情報</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">trans_self</span> <span class="o">=</span> <span class="kc">None</span> <span class="c1">#自身の変換</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">box_self</span>   <span class="o">=</span> <span class="kc">None</span> <span class="c1">#自身の包含矩形.</span>
        <span class="c1"># self.boxes_   = None #デバグ用_元の包含矩形.</span>
        
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">verbose</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">repo</span><span class="p">(</span><span class="n">msg</span><span class="o">=</span><span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">myinfo</span><span class="p">()</span><span class="si">}</span><span class="s1">.__init__(): </span><span class="si">{</span> <span class="bp">self</span><span class="o">.</span><span class="n">vars</span><span class="p">()</span> <span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>
        <span class="k">return</span>

    <span class="c1"># # exp 基本：子を追加する</span>
    <span class="c1"># def put(self, child=None, trans=None): </span>
    <span class="c1">#     &quot;&quot;&quot;子を追加する．</span>

    <span class="c1">#     Args: </span>
    <span class="c1">#         trans (cairo.Matrix) : 自座標における子の配置を指示する変換行列．原点にある子を所望の場所に配置するためのアフィン変換を表す．</span>

    <span class="c1">#         child (Board): 子として追加するBoardオブジェクト</span>

    <span class="c1">#     Returns:</span>
    <span class="c1">#         (Board) : 追加した子</span>
        
    <span class="c1">#     Example:: </span>
        
    <span class="c1">#     		root = Canvas()</span>
    <span class="c1">#     		child = root.put(Board())</span>
    <span class="c1">#     		child = parent.put(trans=Translate(x=1, y=2), </span>
    <span class="c1">#     			Rectangle())</span>
    <span class="c1">#     &quot;&quot;&quot;</span>
    <span class="c1">#     def _vars_put_(board=None):</span>
    <span class="c1">#         return kw.extract(kwargs=vars(board),</span>
    <span class="c1">#                           keys=[&#39;cmd&#39;,&#39;depth&#39;,&#39;verbose&#39;])</span>
    <span class="c1">#     #子の型チェック</span>
    <span class="c1">#     com.ensure(child != None and isinstance(child, BoardBase),</span>
    <span class="c1">#                f&#39;{self.myinfo()}.put(): child must be a BoardBase!: {child}&#39;) </span>
    <span class="c1">#     # 親子関係の管理</span>
    <span class="c1">#     self.register_child(child)</span>

    <span class="c1">#     # 子を追加する</span>
    <span class="c1">#     if self.max_children_ &gt;= 0 and len(self.children_) &gt;= self.max_children_:</span>
    <span class="c1">#         com.panic(f&#39;cannot add more than max_children_={self.max_children_}!&#39;)</span>
    <span class="c1">#     else:</span>
    <span class="c1">#         child.ord_ = len(self.children_)      #子ID</span>
    <span class="c1">#         self.children_.append((trans, child)) #子リスト</span>

    <span class="c1">#     #</span>
    <span class="c1">#     if self.verbose: self.repo(msg=f&#39;=&gt; added: {self.myinfo()}.put(): trans={trans} child={ child } with vars={ child.vars() }...&#39;)</span>
        
    <span class="c1">#     return child #Do not change!</span>

    
    <span class="c1">#=====</span>
    <span class="c1"># 雑関数</span>
    <span class="c1">#=====</span>

<div class="viewcode-block" id="BoardBase.get_box"><a class="viewcode-back" href="../../board.html#board.cboard.BoardBase.get_box">[ドキュメント]</a>    <span class="k">def</span> <span class="nf">get_box</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">box</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">box_self</span>
        <span class="n">com</span><span class="o">.</span><span class="n">ensure</span><span class="p">(</span><span class="n">box</span><span class="o">==</span><span class="kc">None</span> <span class="ow">or</span> <span class="n">crt</span><span class="o">.</span><span class="n">isProperBox</span><span class="p">(</span><span class="n">box</span><span class="p">),</span>
                   <span class="sa">f</span><span class="s1">&#39;get_box: box must be isProperBox&#39;</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">box</span></div>


    <span class="c1"># exp 基本：配置の計算</span>
    <span class="k">def</span> <span class="nf">_arrange</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;配置を計算する．配置は，ボトムアップに再帰的に計算される．</span>

<span class="sd">        Returns: </span>
<span class="sd">        	rect: 計算済みの自身の包含矩形オブジェクト</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">verbose</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">repo</span><span class="p">(</span><span class="n">msg</span><span class="o">=</span><span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">myinfo</span><span class="p">()</span><span class="si">}</span><span class="s1">._arrange(): </span><span class="si">{</span> <span class="bp">self</span><span class="o">.</span><span class="n">vars</span><span class="p">()</span> <span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>

        <span class="c1">#子供全ての包含長方形を計算する</span>
        <span class="n">boxes</span> <span class="o">=</span> <span class="n">EMPTY_RECT</span>
        
        <span class="c1">#自身の描画配置情報を得る</span>
        <span class="n">box0</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">arrange_me</span><span class="p">()</span>
        <span class="n">boxes</span> <span class="o">=</span> <span class="n">crt</span><span class="o">.</span><span class="n">box_union</span><span class="p">(</span><span class="n">boxes</span><span class="p">,</span> <span class="n">box0</span><span class="p">)</span> <span class="c1">#包含矩形の更新</span>
        
        <span class="c1"># for idx, pair in enumerate(self.children()):</span>
        <span class="k">for</span> <span class="n">idx</span><span class="p">,</span> <span class="n">pair</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">children_enumerated</span><span class="p">():</span>
            <span class="n">trans</span><span class="p">,</span> <span class="n">child</span> <span class="o">=</span> <span class="n">pair</span> <span class="c1">#分解</span>
            <span class="c1">#子の型チェック</span>
            <span class="n">com</span><span class="o">.</span><span class="n">ensure</span><span class="p">(</span><span class="nb">isinstance</span><span class="p">(</span><span class="n">child</span><span class="p">,</span> <span class="n">BoardBase</span><span class="p">),</span>
                       <span class="s1">&#39;child must be a subclass of BoardBase!: </span><span class="si">{child}</span><span class="s1">&#39;</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">trans</span><span class="p">:</span>
                <span class="n">com</span><span class="o">.</span><span class="n">ensure</span><span class="p">(</span><span class="nb">isinstance</span><span class="p">(</span><span class="n">trans</span><span class="p">,</span> <span class="n">crt</span><span class="o">.</span><span class="n">GeoTransform</span><span class="p">),</span>
                           <span class="sa">f</span><span class="s1">&#39;trans must be of crt.GeoTransform: </span><span class="si">{</span><span class="nb">type</span><span class="p">(</span><span class="n">trans</span><span class="p">)</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">verbose</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">repo</span><span class="p">(</span><span class="n">msg</span><span class="o">=</span><span class="sa">f</span><span class="s1">&#39;=&gt; calling on </span><span class="si">{</span><span class="n">idx</span><span class="si">}</span><span class="s1">-th child=</span><span class="si">{</span><span class="n">child</span><span class="o">.</span><span class="n">myinfo</span><span class="p">()</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">,</span>
                          <span class="n">isChild</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">header</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
                
            <span class="c1">#子の再帰処理</span>
            <span class="n">child_box</span> <span class="o">=</span> <span class="n">child</span><span class="o">.</span><span class="n">_arrange</span><span class="p">()</span>
                
            <span class="c1">#自身の包含矩形の更新</span>
            <span class="k">if</span> <span class="n">child_box</span><span class="p">:</span>
                <span class="n">child_box</span> <span class="o">=</span> <span class="n">crt</span><span class="o">.</span><span class="n">box_apply_trans</span><span class="p">(</span><span class="n">child_box</span><span class="p">,</span> <span class="n">trans</span><span class="o">=</span><span class="n">trans</span><span class="p">)</span>
                <span class="n">boxes</span> <span class="o">=</span> <span class="n">crt</span><span class="o">.</span><span class="n">box_union</span><span class="p">(</span><span class="n">boxes</span><span class="p">,</span> <span class="n">child_box</span><span class="p">)</span> <span class="c1">#包含矩形の更新</span>
            
        <span class="c1">#子のパック処理をする</span>
        <span class="n">boxes</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_arrange_pack</span><span class="p">(</span><span class="n">boxes</span><span class="p">)</span>
        
        <span class="c1">#注意：関数arrange_self_transformはサブクラスでオーバーライドする</span>
        <span class="c1">#デフォールト: self.trans_self = None, self.box_self := boxes</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">trans_self</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">box_self</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">arrange_anchor</span><span class="p">(</span><span class="n">boxes</span><span class="p">)</span>

        <span class="c1">#自身の描画配置情報を得る．包含矩形の処理は自身の責任で行う．</span>
        <span class="c1">#次の情報を更新できるので注意: self.box_self, self.box_trans</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">arrange_me_post</span><span class="p">()</span>
        
        <span class="k">if</span> <span class="kc">True</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;@debug:trans:</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">myinfo</span><span class="p">()</span><span class="si">}</span><span class="s1">: trans=</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">trans_self</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">verbose</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">repo</span><span class="p">(</span><span class="n">msg</span><span class="o">=</span><span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">myinfo</span><span class="p">()</span><span class="si">}</span><span class="s1">._arrange()=&gt; box=</span><span class="si">{</span> <span class="n">boxes</span> <span class="si">}</span><span class="s1">&#39;</span><span class="p">,</span> <span class="n">isChild</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">box_self</span> 

    <span class="c1"># #To be Override</span>
    <span class="c1"># def arrange_me(self):</span>
    <span class="c1">#     &quot;&quot;&quot;自分の座標系で配置を計算する．子孫クラスでオーバーライドすること&quot;&quot;&quot;</span>
    <span class="c1">#     box = None</span>
    <span class="c1">#     return box</span>

    <span class="c1">#Override </span>
<div class="viewcode-block" id="BoardBase.arrange_me"><a class="viewcode-back" href="../../board.html#board.cboard.BoardBase.arrange_me">[ドキュメント]</a>    <span class="k">def</span> <span class="nf">arrange_me</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">width</span> <span class="o">=</span> <span class="n">kw</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">kwargs</span><span class="p">,</span> <span class="s1">&#39;width&#39;</span><span class="p">)</span>
        <span class="n">height</span> <span class="o">=</span> <span class="n">kw</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">kwargs</span><span class="p">,</span> <span class="s1">&#39;height&#39;</span><span class="p">)</span>
        <span class="n">box</span> <span class="o">=</span> <span class="kc">None</span> 
        <span class="k">if</span> <span class="n">width</span><span class="o">!=</span><span class="kc">None</span> <span class="ow">and</span> <span class="n">height</span><span class="o">!=</span><span class="kc">None</span><span class="p">:</span> 
            <span class="n">x</span> <span class="o">=</span> <span class="n">kw</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">kwargs</span><span class="p">,</span> <span class="s1">&#39;x&#39;</span><span class="p">,</span> <span class="n">default</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
            <span class="n">y</span> <span class="o">=</span> <span class="n">kw</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">kwargs</span><span class="p">,</span> <span class="s1">&#39;y&#39;</span><span class="p">,</span> <span class="n">default</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
            <span class="n">box</span> <span class="o">=</span> <span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">x</span><span class="o">+</span><span class="n">width</span><span class="p">,</span> <span class="n">y</span><span class="o">+</span><span class="n">height</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">box</span> </div>

    <span class="c1">#To be Override</span>
    <span class="k">def</span> <span class="nf">_arrange_pack</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">boxes_last</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;自分の座標系で配置を計算する．子孫クラスでオーバーライドすること&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="n">boxes_last</span>
        
    <span class="c1">#To be Override</span>
<div class="viewcode-block" id="BoardBase.arrange_me_post"><a class="viewcode-back" href="../../board.html#board.cboard.BoardBase.arrange_me_post">[ドキュメント]</a>    <span class="k">def</span> <span class="nf">arrange_me_post</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;自分の座標系で配置を計算する．子孫クラスでオーバーライドすること&quot;&quot;&quot;</span>
        <span class="n">box</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="k">return</span> <span class="n">box</span> </div>
        
    <span class="c1">#To be Override</span>
<div class="viewcode-block" id="BoardBase.arrange_anchor"><a class="viewcode-back" href="../../board.html#board.cboard.BoardBase.arrange_anchor">[ドキュメント]</a>    <span class="k">def</span> <span class="nf">arrange_anchor</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">box</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;アンカー情報から，変換と包含矩形を計算する．子孫クラスでオーバーライドすること&quot;&quot;&quot;</span>
        <span class="n">trans</span> <span class="o">=</span> <span class="kc">None</span> <span class="c1">#identity</span>
        <span class="k">return</span> <span class="n">trans</span><span class="p">,</span> <span class="n">box</span></div>
        
    <span class="c1"># #Override</span>
    <span class="c1"># def arrange_modify_child(self, trans, child, child_box):</span>
    <span class="c1">#     &quot;&quot;&quot;変換と，子ボード，子の包含矩形から，更新した変換と子ボードを返す．上書きすること．</span>
    <span class="c1">#     &quot;&quot;&quot;</span>
    <span class="c1">#     ##必要ならここで何かする．とりあえず，そのまま返す．</span>
    <span class="c1">#     return trans, child</span>

    <span class="c1">#=====</span>
    <span class="c1"># 描画</span>
    <span class="c1">#=====</span>
    <span class="k">def</span> <span class="nf">_draw</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">cr</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;トップダウンに画像を描画する．</span>

<span class="sd">        Args: </span>
<span class="sd">             trans (crt.GeoTransform) : 空間変換</span>

<span class="sd">             pm0 (pim.ImageBoard) : 基本描画のプリミティブボード</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">verbose</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">repo</span><span class="p">(</span><span class="n">isChild</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">msg</span><span class="o">=</span><span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">myinfo</span><span class="p">()</span><span class="si">}</span><span class="s1">._draw(): </span><span class="si">{</span> <span class="bp">self</span><span class="o">.</span><span class="n">vars</span><span class="p">()</span> <span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>
            
        <span class="c1">## 自分の空間を開く</span>
        <span class="n">cr</span><span class="o">.</span><span class="n">save</span><span class="p">()</span>  <span class="c1">##self</span>
        <span class="c1">## 自身の変換を適用する</span>
        <span class="n">crt</span><span class="o">.</span><span class="n">cr_apply_trans</span><span class="p">(</span><span class="n">trans</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">trans_self</span><span class="p">,</span> <span class="n">context</span><span class="o">=</span><span class="n">cr</span><span class="p">)</span>
        <span class="k">if</span> <span class="kc">True</span><span class="p">:</span> <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;@debug:draw:self:</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">myinfo</span><span class="p">()</span><span class="si">}</span><span class="s1">: apply trans_self=</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">trans_self</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>
            
        <span class="c1">#必要なら自分の描画を行う</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">draw_me</span><span class="p">(</span><span class="n">cr</span><span class="p">)</span>
        
        <span class="c1">#子の描画を行う</span>
        <span class="k">for</span> <span class="n">idx</span><span class="p">,</span> <span class="n">pair</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">children_enumerated</span><span class="p">():</span>
            <span class="n">trans</span><span class="p">,</span> <span class="n">child</span> <span class="o">=</span> <span class="n">pair</span> <span class="c1">#分解</span>
            <span class="c1">#子の型チェック</span>
            <span class="n">com</span><span class="o">.</span><span class="n">ensure</span><span class="p">(</span><span class="nb">isinstance</span><span class="p">(</span><span class="n">child</span><span class="p">,</span> <span class="n">BoardBase</span><span class="p">),</span>
                       <span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">myinfo</span><span class="p">()</span><span class="si">}</span><span class="s1">.draw: child must be a subclass of BoardBase!: </span><span class="si">{</span><span class="n">child</span><span class="si">}</span><span class="s1">&#39;</span><span class="o">+</span>
                       <span class="sa">f</span><span class="s1">&#39;: children_=</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">children_</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>
            
            <span class="n">cr</span><span class="o">.</span><span class="n">save</span><span class="p">()</span>    <span class="c1">## 子の空間を開く</span>
            <span class="n">crt</span><span class="o">.</span><span class="n">cr_apply_trans</span><span class="p">(</span><span class="n">trans</span><span class="o">=</span><span class="n">trans</span><span class="p">,</span> <span class="n">context</span><span class="o">=</span><span class="n">cr</span><span class="p">)</span> <span class="c1">## 変換を適用する</span>
            <span class="k">if</span> <span class="kc">True</span><span class="p">:</span> <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;- @debug:draw:child:</span><span class="si">{</span><span class="n">child</span><span class="o">.</span><span class="n">myinfo</span><span class="p">()</span><span class="si">}</span><span class="s1">: apply trans=</span><span class="si">{</span><span class="n">trans</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>
            <span class="n">child</span><span class="o">.</span><span class="n">_draw</span><span class="p">(</span><span class="n">cr</span><span class="p">)</span>
            <span class="n">cr</span><span class="o">.</span><span class="n">restore</span><span class="p">()</span> <span class="c1">## 子の空間を閉じる</span>

        <span class="c1">#必要なら自分の描画を行う</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">draw_me_post</span><span class="p">(</span><span class="n">cr</span><span class="p">)</span>

        <span class="c1">## 自分の空間を閉じる</span>
        <span class="n">cr</span><span class="o">.</span><span class="n">restore</span><span class="p">()</span>  <span class="c1">##self</span>

        <span class="c1">## debug: 包含矩形を描画する</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">fetch</span><span class="p">(</span><span class="n">key</span><span class="o">=</span><span class="s1">&#39;boundingbox&#39;</span><span class="p">,</span> <span class="n">default</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span> <span class="ow">and</span> <span class="n">crt</span><span class="o">.</span><span class="n">isBoxOrPoint</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">get_box</span><span class="p">()):</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">verbose</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">repo</span><span class="p">(</span><span class="n">msg</span><span class="o">=</span><span class="sa">f</span><span class="s1">&#39;@option boundingbox: draw my box=</span><span class="si">{</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_box</span><span class="p">()</span> <span class="si">}</span><span class="s1">&#39;</span><span class="p">,</span> <span class="n">isChild</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">draw_perturbed_box</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">get_box</span><span class="p">(),</span> <span class="n">context</span><span class="o">=</span><span class="n">cr</span><span class="p">)</span>

        <span class="c1"># debug: 自分の原点位置をマーカーで描画する．</span>
        <span class="k">if</span> <span class="n">kw</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">kwargs</span><span class="p">,</span> <span class="n">key</span><span class="o">=</span><span class="s1">&#39;show_origin&#39;</span><span class="p">,</span> <span class="n">default</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
            <span class="n">rgb</span> <span class="o">=</span> <span class="n">kw</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">kwargs</span><span class="p">,</span> <span class="n">key</span><span class="o">=</span><span class="s1">&#39;rgb_origin&#39;</span><span class="p">,</span>
                         <span class="n">default</span><span class="o">=</span><span class="n">crt</span><span class="o">.</span><span class="n">MYCOL</span><span class="p">[</span><span class="s1">&#39;red&#39;</span><span class="p">])</span>
            <span class="n">angle</span> <span class="o">=</span> <span class="n">kw</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">kwargs</span><span class="p">,</span> <span class="n">key</span><span class="o">=</span><span class="s1">&#39;angle_origin&#39;</span><span class="p">,</span>
                         <span class="n">default</span><span class="o">=</span><span class="n">math</span><span class="o">.</span><span class="n">pi</span><span class="o">/</span><span class="mi">4</span><span class="p">)</span>
            <span class="n">crt</span><span class="o">.</span><span class="n">cr_draw_marker_cross</span><span class="p">(</span><span class="n">context</span><span class="o">=</span><span class="n">cr</span><span class="p">,</span> <span class="n">x</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span><span class="n">y</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span>
                                     <span class="n">linewidth</span><span class="o">=</span><span class="mf">0.5</span><span class="p">,</span> <span class="n">angle</span><span class="o">=</span><span class="n">angle</span><span class="p">,</span> 
                                     <span class="n">rgb</span><span class="o">=</span><span class="n">crt</span><span class="o">.</span><span class="n">cr_add_alpha</span><span class="p">(</span><span class="n">rgb</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.5</span><span class="p">))</span>
        <span class="c1"># debug: 自分の原点位置をマーカーで描画する．</span>
        <span class="k">if</span> <span class="n">kw</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">kwargs</span><span class="p">,</span> <span class="n">key</span><span class="o">=</span><span class="s1">&#39;show_box&#39;</span><span class="p">,</span> <span class="n">default</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
            <span class="n">rgb</span> <span class="o">=</span> <span class="n">kw</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">kwargs</span><span class="p">,</span> <span class="n">key</span><span class="o">=</span><span class="s1">&#39;rgb_box&#39;</span><span class="p">,</span>
                         <span class="n">default</span><span class="o">=</span><span class="n">crt</span><span class="o">.</span><span class="n">MYCOL</span><span class="p">[</span><span class="s1">&#39;green&#39;</span><span class="p">])</span>
            <span class="p">(</span><span class="n">x0</span><span class="p">,</span> <span class="n">y0</span><span class="p">,</span> <span class="n">x1</span><span class="p">,</span> <span class="n">y1</span><span class="p">)</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_box</span><span class="p">()</span>
            <span class="n">crt</span><span class="o">.</span><span class="n">cr_rectangle</span><span class="p">(</span><span class="n">x0</span><span class="p">,</span> <span class="n">y0</span><span class="p">,</span> <span class="n">x1</span> <span class="o">-</span> <span class="n">x0</span><span class="p">,</span> <span class="n">y1</span> <span class="o">-</span> <span class="n">y0</span><span class="p">,</span>
                             <span class="n">context</span><span class="o">=</span><span class="n">cr</span><span class="p">,</span>
                             <span class="n">rgb</span><span class="o">=</span><span class="n">crt</span><span class="o">.</span><span class="n">cr_add_alpha</span><span class="p">(</span><span class="n">rgb</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.5</span><span class="p">),</span> 
                             <span class="n">line_width</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
        <span class="k">return</span>

    <span class="c1"># 派生：Override</span>
<div class="viewcode-block" id="BoardBase.draw_me"><a class="viewcode-back" href="../../board.html#board.cboard.BoardBase.draw_me">[ドキュメント]</a>    <span class="k">def</span> <span class="nf">draw_me</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">cr</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;自分の描画を行う．子孫クラスでオーバーライドすること．</span>

<span class="sd">        Args: </span>
<span class="sd">             cr (Cairo.Context) : Cairoの文脈オブジェクト</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">verbose</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">repo</span><span class="p">(</span><span class="n">isChild</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">msg</span><span class="o">=</span><span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">myinfo</span><span class="p">()</span><span class="si">}</span><span class="s1">.draw_me()...&#39;</span><span class="p">)</span>
        <span class="c1">## ここでcontext crに何か描く．</span>
        <span class="k">return</span> </div>

    <span class="c1"># 派生：Override</span>
<div class="viewcode-block" id="BoardBase.draw_me_post"><a class="viewcode-back" href="../../board.html#board.cboard.BoardBase.draw_me_post">[ドキュメント]</a>    <span class="k">def</span> <span class="nf">draw_me_post</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">cr</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;自分の描画を行う．子孫クラスでオーバーライドすること．</span>

<span class="sd">        Args: </span>
<span class="sd">             cr (Cairo.Context) : Cairoの文脈オブジェクト</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">verbose</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">repo</span><span class="p">(</span><span class="n">isChild</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">msg</span><span class="o">=</span><span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">myinfo</span><span class="p">()</span><span class="si">}</span><span class="s1">.draw_me()...&#39;</span><span class="p">)</span>
        <span class="c1">## ここでcontext crに何か描く．</span>
        <span class="k">return</span></div>

    <span class="c1">#=====</span>
    <span class="c1"># おまけ関数．drawの副関数</span>
    <span class="c1">#=====</span>
<div class="viewcode-block" id="BoardBase.draw_perturbed_box"><a class="viewcode-back" href="../../board.html#board.cboard.BoardBase.draw_perturbed_box">[ドキュメント]</a>    <span class="k">def</span> <span class="nf">draw_perturbed_box</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">box</span><span class="p">,</span> <span class="n">context</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">max_perturb</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;位置を</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">cr</span> <span class="o">=</span> <span class="n">context</span> 
        <span class="n">box</span> <span class="o">=</span> <span class="n">crt</span><span class="o">.</span><span class="n">box_normalize</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">get_box</span><span class="p">())</span>
        <span class="n">x</span><span class="p">,</span> <span class="n">y</span> <span class="o">=</span> <span class="n">box</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">box</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
        <span class="n">width</span><span class="p">,</span> <span class="n">height</span><span class="o">=</span><span class="p">(</span><span class="n">box</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span><span class="o">-</span><span class="n">box</span><span class="p">[</span><span class="mi">0</span><span class="p">]),</span> <span class="p">(</span><span class="n">box</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span><span class="o">-</span><span class="n">box</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
        <span class="c1">## 色を選ぶ</span>
        <span class="n">rgb</span> <span class="o">=</span> <span class="n">MYCOLS</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>  <span class="c1">## 色</span>
        <span class="n">rgb_alpha</span> <span class="o">=</span> <span class="mf">0.25</span> <span class="c1">## 色の透明度</span>
        <span class="c1"># rgb_alpha = 0.5</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">depth</span><span class="p">:</span> 
            <span class="n">rgb</span> <span class="o">=</span> <span class="n">MYCOLS</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">depth</span> <span class="o">%</span> <span class="nb">len</span><span class="p">(</span><span class="n">MYCOLS</span><span class="p">)]</span>  <span class="c1">## 色</span>
            <span class="n">rgb</span> <span class="o">=</span> <span class="p">(</span><span class="n">rgb</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">rgb</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">rgb</span><span class="p">[</span><span class="mi">2</span><span class="p">],</span> <span class="n">rgb_alpha</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">verbose</span><span class="p">:</span> <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;debug: self.depth=None at </span><span class="si">{</span> <span class="bp">self</span><span class="o">.</span><span class="n">myinfo</span><span class="p">()</span> <span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>
        <span class="c1">## 位置を微小変動させる</span>
        <span class="n">max_perturb</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">fetch</span><span class="p">(</span><span class="n">key</span><span class="o">=</span><span class="s1">&#39;max_perturb&#39;</span><span class="p">,</span> <span class="n">default</span><span class="o">=</span><span class="mf">8.0</span> <span class="o">*</span> <span class="n">DEFAULT_LINE_WIDTH</span><span class="p">)</span>
        <span class="n">com</span><span class="o">.</span><span class="n">ensure</span><span class="p">(</span><span class="n">max_perturb</span> <span class="o">!=</span> <span class="kc">None</span><span class="p">,</span> <span class="sa">f</span><span class="s1">&#39;max_perturb=</span><span class="si">{</span><span class="n">max_perturb</span><span class="si">}</span><span class="s1"> must be defined!&#39;</span><span class="p">)</span>
        <span class="n">dx</span> <span class="o">=</span> <span class="n">dy</span> <span class="o">=</span> <span class="n">max_perturb</span><span class="o">*</span><span class="n">random</span><span class="o">.</span><span class="n">random</span><span class="p">()</span> <span class="o">-</span> <span class="mf">0.5</span><span class="o">*</span><span class="n">max_perturb</span> 
        <span class="n">crt</span><span class="o">.</span><span class="n">cr_rectangle</span><span class="p">(</span><span class="n">x</span> <span class="o">+</span> <span class="n">dx</span><span class="p">,</span> <span class="n">y</span> <span class="o">+</span> <span class="n">dy</span><span class="p">,</span> <span class="n">width</span><span class="p">,</span> <span class="n">height</span><span class="p">,</span>
                         <span class="n">source_rgb</span><span class="o">=</span><span class="n">rgb</span><span class="p">,</span>
                         <span class="n">line_width</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span>
                         <span class="n">context</span><span class="o">=</span><span class="n">cr</span><span class="p">)</span>
        
        <span class="c1">## キャプション</span>
        <span class="n">tx</span><span class="p">,</span> <span class="n">ty</span> <span class="o">=</span> <span class="n">x</span> <span class="o">+</span> <span class="n">dx</span><span class="p">,</span> <span class="n">y</span> <span class="o">+</span> <span class="n">dy</span>
        <span class="n">fsize</span> <span class="o">=</span> <span class="mi">4</span>
        <span class="n">fmargin</span> <span class="o">=</span> <span class="mf">0.25</span><span class="o">*</span><span class="n">fsize</span>
        <span class="n">msg</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">myinfo</span><span class="p">()</span>
        <span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">width</span><span class="p">,</span> <span class="n">height</span><span class="p">,</span> <span class="n">dx</span><span class="p">,</span> <span class="n">dy</span> <span class="o">=</span> <span class="n">crt</span><span class="o">.</span><span class="n">cr_text_extent</span><span class="p">(</span><span class="n">tx</span><span class="p">,</span> <span class="n">ty</span><span class="p">,</span> <span class="n">msg</span><span class="o">=</span><span class="n">msg</span><span class="p">,</span> <span class="n">context</span><span class="o">=</span><span class="n">cr</span><span class="p">)</span>
        <span class="n">crt</span><span class="o">.</span><span class="n">cr_text</span><span class="p">(</span><span class="n">tx</span> <span class="o">+</span> <span class="n">fmargin</span><span class="p">,</span> <span class="n">ty</span> <span class="o">+</span> <span class="mf">1.0</span><span class="o">*</span><span class="n">dy</span> <span class="o">+</span> <span class="n">fmargin</span><span class="p">,</span> <span class="n">msg</span><span class="o">=</span><span class="n">msg</span><span class="p">,</span> <span class="n">fsize</span><span class="o">=</span><span class="n">fsize</span><span class="p">,</span> 
                    <span class="n">context</span><span class="o">=</span><span class="n">cr</span><span class="p">)</span>

        <span class="k">return</span> </div>

    <span class="c1">#==========</span>
    <span class="c1"># 座標系</span>
    <span class="c1">#==========</span>
<div class="viewcode-block" id="BoardBase.get_anchor_point"><a class="viewcode-back" href="../../board.html#board.cboard.BoardBase.get_anchor_point">[ドキュメント]</a>    <span class="k">def</span> <span class="nf">get_anchor_point</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">anchor_x</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">anchor_y</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">anchor</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;アンカー指定から，自身の包含矩形上の対応する点を返す．</span>

<span class="sd">        Args: </span>

<span class="sd">             anchor_x (str) : 横方向の位置指示 in (left, middle, right)</span>

<span class="sd">             anchor_y (str) : 縦方向の位置指示 in (top, middle, bottom, above, below)</span>

<span class="sd">             anchor (str) : 代替の位置指示．内容に応じて横または縦の位置表示として用いる．ただし，anchor_xまたはanchor_yを優先し，両方設定しようとするとエラーを呼ぶ．</span>

<span class="sd">        Returns: </span>

<span class="sd">             (tuple(float, float)) : アンカー点(x,y)</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1">## exp: アンカー情報を用いて，変換transを求める</span>
        
        <span class="c1"># アンカーキーワードから，アンカー比率を返す．</span>
        <span class="n">ratio_x</span><span class="p">,</span> <span class="n">ratio_y</span> <span class="o">=</span> <span class="n">crt</span><span class="o">.</span><span class="n">get_anchor_ratio</span><span class="p">(</span><span class="n">anchor_x</span><span class="o">=</span><span class="n">anchor_x</span><span class="p">,</span> <span class="n">anchor_y</span><span class="o">=</span><span class="n">anchor_y</span><span class="p">,</span> <span class="n">anchor</span><span class="o">=</span><span class="n">anchor</span><span class="p">)</span>
        <span class="n">com</span><span class="o">.</span><span class="n">ensure</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">get_box</span><span class="p">()</span> <span class="o">!=</span> <span class="kc">None</span><span class="p">,</span> <span class="sa">f</span><span class="s1">&#39;self.box_self is None!&#39;</span><span class="p">)</span>
        <span class="n">x</span><span class="p">,</span> <span class="n">y</span> <span class="o">=</span> <span class="n">crt</span><span class="o">.</span><span class="n">get_point_by_anchor_ratio</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">box_self</span><span class="p">,</span> <span class="n">ratio_x</span><span class="o">=</span><span class="n">ratio_x</span><span class="p">,</span> <span class="n">ratio_y</span><span class="o">=</span><span class="n">ratio_y</span><span class="p">)</span>
        <span class="n">com</span><span class="o">.</span><span class="n">ensure</span><span class="p">(</span><span class="nb">isinstance</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="p">(</span><span class="nb">float</span><span class="p">,</span> <span class="nb">int</span><span class="p">))</span> <span class="ow">and</span>
                   <span class="nb">isinstance</span><span class="p">(</span><span class="n">y</span><span class="p">,</span> <span class="p">(</span><span class="nb">float</span><span class="p">,</span> <span class="nb">int</span><span class="p">)),</span>
                   <span class="sa">f</span><span class="s1">&#39;x=</span><span class="si">{</span><span class="n">x</span><span class="si">}</span><span class="s1"> and y=</span><span class="si">{</span><span class="n">y</span><span class="si">}</span><span class="s1"> must be numbers&#39;</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">x</span><span class="p">,</span> <span class="n">y</span></div>

    <span class="k">pass</span> <span class="c1">## end class BoardBase </span>


    <span class="c1">#==========</span>
    <span class="c1"># 外部アクセス: exp</span>
    <span class="c1">#==========</span>
<div class="viewcode-block" id="BoardBase.relative_apath_get"><a class="viewcode-back" href="../../board.html#board.cboard.BoardBase.relative_apath_get">[ドキュメント]</a>    <span class="k">def</span> <span class="nf">relative_apath_get</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">top</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">cid</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">apath</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">hgt</span><span class="o">=</span><span class="mi">0</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;基準オブジェクトから自身へのアクセスパス（子添字列）を返す．</span>
<span class="sd">        Args: </span>
<span class="sd">          top (BoardBase) : 基準オブジェクト．このBoardBaseか根へ到達すると停止する．</span>
<span class="sd">        Returns: </span>
<span class="sd">          (list(int)) : 成功すれば，基準オブジェクトから自身へのアクセスパス（子添字列）．失敗すればNone</span>
<span class="sd">        Note: </span>
<span class="sd">          仮定：self.depth==Noneの場合は，全ての子孫のdepth==None</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">com</span><span class="o">.</span><span class="n">ensure</span><span class="p">(</span><span class="n">top</span><span class="o">!=</span><span class="kc">None</span><span class="p">,</span> <span class="sa">f</span><span class="s1">&#39;top must not be None!&#39;</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">apath</span><span class="o">==</span><span class="kc">None</span><span class="p">:</span>
            <span class="n">apath</span><span class="o">=</span><span class="p">[]</span>
        <span class="n">apath</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="bp">self</span><span class="p">,</span> <span class="n">cid</span><span class="p">))</span>
        <span class="n">pa</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">parent</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">==</span><span class="n">top</span><span class="p">:</span> 
            <span class="n">apath</span><span class="o">.</span><span class="n">reverse</span><span class="p">()</span> <span class="c1">#return None</span>
            <span class="k">return</span> <span class="n">apath</span>
        <span class="k">elif</span> <span class="n">pa</span><span class="o">==</span><span class="kc">None</span> <span class="ow">or</span> <span class="p">(</span><span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">pa</span><span class="p">,</span> <span class="n">BoardBase</span><span class="p">)):</span>
            <span class="k">return</span> <span class="kc">None</span> 
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">pa</span><span class="o">.</span><span class="n">relative_apath_get</span><span class="p">(</span><span class="n">top</span><span class="o">=</span><span class="n">top</span><span class="p">,</span> <span class="n">cid</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">ord_</span><span class="p">,</span> <span class="n">apath</span><span class="o">=</span><span class="n">apath</span><span class="p">,</span> 
                                      <span class="n">hgt</span><span class="o">=</span><span class="n">hgt</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span></div>
    
<div class="viewcode-block" id="BoardBase.relative_apath_to_tpath"><a class="viewcode-back" href="../../board.html#board.cboard.BoardBase.relative_apath_to_tpath">[ドキュメント]</a>    <span class="k">def</span> <span class="nf">relative_apath_to_tpath</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">apath</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">tpath</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
                                <span class="n">verbose</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;点p=(x,y)を，アクセスパスapath=((), ..., ())</span>

<span class="sd">        Args: </span>
<span class="sd">             p (tuple) : 点p=(x,y) or 矩形p=(x0, y0, x1, y1)</span>

<span class="sd">             apath (list) : (ord, board)のリスト．最初の要素はord=None</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">verbose</span><span class="p">:</span> <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;debug: call apath=</span><span class="si">{</span><span class="n">apath</span><span class="si">}</span><span class="s1"> </span><span class="se">\t</span><span class="s1"> tpath=</span><span class="si">{</span><span class="n">tpath</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">tpath</span><span class="o">==</span><span class="kc">None</span><span class="p">:</span>
            <span class="n">tpath</span><span class="o">=</span><span class="p">[]</span>
            
        <span class="k">if</span> <span class="n">apath</span><span class="o">==</span><span class="kc">None</span> <span class="ow">or</span> <span class="nb">len</span><span class="p">(</span><span class="n">apath</span><span class="p">)</span><span class="o">==</span><span class="mi">0</span><span class="p">:</span> 
            <span class="k">return</span> <span class="n">tpath</span>
        
        <span class="n">node</span><span class="p">,</span> <span class="nb">ord</span> <span class="o">=</span> <span class="n">apath</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
        <span class="n">com</span><span class="o">.</span><span class="n">ensure</span><span class="p">(</span><span class="nb">isinstance</span><span class="p">(</span><span class="n">node</span><span class="p">,</span> <span class="n">BoardBase</span><span class="p">),</span> <span class="sa">f</span><span class="s1">&#39;node must be of BoardBase type!&#39;</span><span class="p">)</span>
        <span class="k">if</span> <span class="nb">ord</span><span class="o">==</span><span class="kc">None</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">verbose</span><span class="p">:</span> <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;</span><span class="se">\t</span><span class="s1">debug: last element!&#39;</span><span class="p">)</span>
            <span class="k">return</span> <span class="n">tpath</span>
        <span class="k">elif</span> <span class="ow">not</span> <span class="p">(</span><span class="nb">ord</span> <span class="o">&lt;</span> <span class="nb">len</span><span class="p">(</span><span class="n">node</span><span class="o">.</span><span class="n">children_</span><span class="p">)):</span>
            <span class="n">com</span><span class="o">.</span><span class="n">panic</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;ord=</span><span class="si">{</span><span class="nb">ord</span><span class="si">}</span><span class="s1"> is out of range!:&#39;</span><span class="o">+</span>
                      <span class="sa">f</span><span class="s1">&#39; num children=</span><span class="si">{</span> <span class="nb">len</span><span class="p">(</span><span class="n">node</span><span class="o">.</span><span class="n">children_</span><span class="p">)</span> <span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span> 
            <span class="n">trans</span><span class="p">,</span> <span class="n">child</span> <span class="o">=</span> <span class="n">node</span><span class="o">.</span><span class="n">children_</span><span class="p">[</span><span class="nb">ord</span><span class="p">]</span>
            <span class="n">tpath</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">trans</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">verbose</span><span class="p">:</span>
                <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;</span><span class="se">\t</span><span class="s1">debug: visit </span><span class="si">{</span> <span class="p">(</span><span class="n">node</span><span class="o">.</span><span class="n">myinfo</span><span class="p">(),</span> <span class="nb">ord</span><span class="p">)</span> <span class="si">}</span><span class="s1"> =&gt; </span><span class="si">{</span> <span class="n">trans</span> <span class="si">}</span><span class="s1"> tpath=</span><span class="si">{</span><span class="n">tpath</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>
            <span class="n">apath1</span> <span class="o">=</span> <span class="n">apath</span><span class="p">[</span><span class="mi">1</span><span class="p">:]</span>
            <span class="k">return</span> <span class="n">child</span><span class="o">.</span><span class="n">relative_apath_to_tpath</span><span class="p">(</span><span class="n">apath</span><span class="o">=</span><span class="n">apath1</span><span class="p">,</span> <span class="n">tpath</span><span class="o">=</span><span class="n">tpath</span><span class="p">,</span> <span class="n">verbose</span><span class="o">=</span><span class="n">verbose</span><span class="p">)</span></div>
    
<div class="viewcode-block" id="BoardBase.relative_apply_transform_by_apath"><a class="viewcode-back" href="../../board.html#board.cboard.BoardBase.relative_apply_transform_by_apath">[ドキュメント]</a>    <span class="k">def</span> <span class="nf">relative_apply_transform_by_apath</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">p</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">apath</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
                                          <span class="n">verbose</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;点p=(x,y)を，アクセスパスapath=((), ..., ())</span>

<span class="sd">        Args: </span>
<span class="sd">             p (tuple) : 点p=(x,y) or 矩形p=(x0, y0, x1, y1)</span>

<span class="sd">             apath (list) : (ord, board)のリスト．最初の要素はord=None</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">apath</span><span class="p">)</span><span class="o">==</span><span class="mi">0</span><span class="p">:</span>
            <span class="n">com</span><span class="o">.</span><span class="n">panic</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;- empty list; It must not reach!&#39;</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">x</span><span class="p">,</span> <span class="nb">ord</span> <span class="o">=</span> <span class="n">apath</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
            <span class="n">com</span><span class="o">.</span><span class="n">ensure</span><span class="p">(</span><span class="nb">isinstance</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">BoardBase</span><span class="p">),</span> <span class="sa">f</span><span class="s1">&#39;x must be of BoardBase type!&#39;</span><span class="p">)</span>
            <span class="n">com</span><span class="o">.</span><span class="n">ensure</span><span class="p">(</span><span class="bp">self</span><span class="o">==</span><span class="n">x</span><span class="p">,</span> <span class="sa">f</span><span class="s1">&#39;condition self==apath[0][0] must hold!&#39;</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">verbose</span><span class="p">:</span>
                <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;</span><span class="se">\t</span><span class="s1">debug: relative_transform_point_by_apath: p=</span><span class="si">{</span> <span class="n">p</span> <span class="si">}</span><span class="se">\t</span><span class="s1">apath[0]=</span><span class="si">{</span> <span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="nb">ord</span><span class="p">)</span> <span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>
            <span class="k">if</span> <span class="nb">ord</span><span class="o">==</span><span class="kc">None</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">verbose</span><span class="p">:</span> <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;- last element; return p=</span><span class="si">{</span> <span class="n">p</span> <span class="si">}</span><span class="s1">!&#39;</span><span class="p">)</span>
                <span class="k">return</span> <span class="n">p</span>
            <span class="k">elif</span> <span class="ow">not</span> <span class="p">(</span><span class="nb">ord</span> <span class="o">&lt;</span> <span class="nb">len</span><span class="p">(</span><span class="n">x</span><span class="o">.</span><span class="n">children_</span><span class="p">)):</span>
                <span class="n">com</span><span class="o">.</span><span class="n">panic</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;ord=</span><span class="si">{</span><span class="nb">ord</span><span class="si">}</span><span class="s1"> is out of range!:&#39;</span><span class="o">+</span>
                          <span class="sa">f</span><span class="s1">&#39; num children=</span><span class="si">{</span> <span class="nb">len</span><span class="p">(</span><span class="n">x</span><span class="o">.</span><span class="n">children_</span><span class="p">)</span> <span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span> 
                <span class="n">trans</span><span class="p">,</span> <span class="n">child</span> <span class="o">=</span> <span class="n">x</span><span class="o">.</span><span class="n">children_</span><span class="p">[</span><span class="nb">ord</span><span class="p">]</span>
                <span class="k">if</span> <span class="n">crt</span><span class="o">.</span><span class="n">isBoxOrPoint</span><span class="p">(</span><span class="n">p</span><span class="p">):</span>
                    <span class="k">if</span> <span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">p</span><span class="p">)</span> <span class="o">==</span> <span class="mi">2</span><span class="p">):</span>
                        <span class="n">p1</span> <span class="o">=</span> <span class="n">trans</span><span class="o">.</span><span class="n">apply_point</span><span class="p">(</span><span class="n">p</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">p</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
                        <span class="c1"># p1 = crt.apply_trans_point(p, trans=trans)</span>
                    <span class="k">elif</span> <span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">p</span><span class="p">)</span> <span class="o">==</span> <span class="mi">4</span><span class="p">):</span>
                        <span class="n">p1</span> <span class="o">=</span> <span class="n">crt</span><span class="o">.</span><span class="n">box_apply_trans</span><span class="p">(</span><span class="n">p</span><span class="p">,</span> <span class="n">trans</span><span class="o">=</span><span class="n">trans</span><span class="p">)</span>
                        <span class="c1"># p1 = crt.box_apply_trans(p, trans=trans)</span>
                    <span class="k">else</span><span class="p">:</span>
                        <span class="n">panic</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;p=</span><span class="si">{</span><span class="n">p</span><span class="si">}</span><span class="s1"> must be either a point or a box!&#39;</span><span class="p">)</span>
                <span class="n">apath1</span> <span class="o">=</span> <span class="n">apath</span><span class="p">[</span><span class="mi">1</span><span class="p">:]</span>
                <span class="k">return</span> <span class="n">child</span><span class="o">.</span><span class="n">relative_apply_transform_by_apath</span><span class="p">(</span><span class="n">p1</span><span class="p">,</span> <span class="n">apath1</span><span class="p">,</span> <span class="n">verbose</span><span class="o">=</span><span class="n">verbose</span><span class="p">)</span></div>
   
<div class="viewcode-block" id="BoardBase.relative_transform"><a class="viewcode-back" href="../../board.html#board.cboard.BoardBase.relative_transform">[ドキュメント]</a>    <span class="k">def</span> <span class="nf">relative_transform</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">p</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">target</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">verbose</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;自身の子孫であるBoardBaseオブジェクトtargetの座標系における，</span>
<span class="sd">        点p=(x,y)の局所座標を返す，</span>

<span class="sd">        Args: </span>
<span class="sd">             target (BoardBase) : 自身の子孫であるBoardBaseオブジェクト</span>

<span class="sd">             p (tuple) : 点p=(x,y)</span>

<span class="sd">        Notes: </span>
<span class="sd">          apath (list) は，selfからtargetへのアクセスパスであり，</span>
<span class="sd">          (board, ord)のリスト．</span>
<span class="sd">          - 末尾以外の要素boardについて，その子はboard.chidren_[ord]であり，</span>
<span class="sd">          - 末尾要素boardに対してはord=Noneである．</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">apath</span> <span class="o">=</span> <span class="n">target</span><span class="o">.</span><span class="n">relative_apath_get</span><span class="p">(</span><span class="n">top</span><span class="o">=</span><span class="bp">self</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">verbose</span><span class="p">:</span> 
            <span class="bp">self</span><span class="o">.</span><span class="n">repo</span><span class="p">(</span><span class="n">msg</span><span class="o">=</span><span class="sa">f</span><span class="s1">&#39;relative_transform_point: apath=</span><span class="si">{</span> <span class="p">[</span> <span class="p">(</span><span class="n">obj</span><span class="p">,</span> <span class="nb">ord</span><span class="p">)</span> <span class="k">for</span> <span class="n">obj</span><span class="p">,</span> <span class="nb">ord</span> <span class="ow">in</span> <span class="n">apath</span> <span class="p">]</span> <span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">relative_apply_transform_by_apath</span><span class="p">(</span><span class="n">p</span><span class="o">=</span><span class="n">p</span><span class="p">,</span> <span class="n">apath</span><span class="o">=</span><span class="n">apath</span><span class="p">,</span>
                                                      <span class="n">verbose</span><span class="o">=</span><span class="n">verbose</span><span class="p">)</span></div></div>
    
<span class="c1">#=====</span>
<span class="c1"># ボードの実装クラス</span>
<span class="c1">#=====</span>
<div class="viewcode-block" id="AnchorBoard"><a class="viewcode-back" href="../../board.html#board.cboard.AnchorBoard">[ドキュメント]</a><span class="k">class</span> <span class="nc">AnchorBoard</span><span class="p">(</span><span class="n">BoardBase</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;画盤オブジェクトのクラス．BoardBaseのラッパー．</span>

<span class="sd">    Args: </span>
<span class="sd">         anchor_x (str) : 横方向の位置指示 in (left, middle, right)</span>

<span class="sd">         anchor_y (str) : 縦方向の位置指示 in (top, middle, bottom, above, below)</span>

<span class="sd">         anchor (str) : 代替の位置指示．内容に応じて横または縦の位置表示として用いる．ただし，anchor_xまたはanchor_yを優先し，両方設定しようとするとエラーを呼ぶ．</span>

<span class="sd">         **kwargs : 他のキーワード引数．上位クラスに渡される．</span>
<span class="sd">    &quot;&quot;&quot;</span>
    
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">anchor_x</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">anchor_y</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">anchor</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="c1">#引数</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
        
        <span class="c1">#アンカーのデフォールト設定</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">anchor_x</span> <span class="o">=</span> <span class="n">com</span><span class="o">.</span><span class="n">ensure_defined</span><span class="p">(</span><span class="n">anchor_x</span><span class="p">,</span> <span class="n">default</span><span class="o">=</span><span class="s1">&#39;left&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">anchor_y</span> <span class="o">=</span> <span class="n">com</span><span class="o">.</span><span class="n">ensure_defined</span><span class="p">(</span><span class="n">anchor_y</span><span class="p">,</span> <span class="n">default</span><span class="o">=</span><span class="s1">&#39;top&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">anchor</span> <span class="o">=</span> <span class="n">anchor</span>
        <span class="c1">#内部変数</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">anchor_ratio_x</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">anchor_ratio_y</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">anchor_trans</span> <span class="o">=</span> <span class="kc">None</span>
        
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">verbose</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">repo</span><span class="p">(</span><span class="n">msg</span><span class="o">=</span><span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">myinfo</span><span class="p">()</span><span class="si">}</span><span class="s1">.__init__(): </span><span class="si">{</span> <span class="bp">self</span><span class="o">.</span><span class="n">vars</span><span class="p">()</span> <span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>
        <span class="k">return</span>

    <span class="c1">#To be Override</span>
<div class="viewcode-block" id="AnchorBoard.arrange_anchor"><a class="viewcode-back" href="../../board.html#board.cboard.AnchorBoard.arrange_anchor">[ドキュメント]</a>    <span class="k">def</span> <span class="nf">arrange_anchor</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">box_native</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;アンカー情報から，変換と包含矩形を計算する．子孫クラスでオーバーライドすること&quot;&quot;&quot;</span>
        <span class="c1">## exp: アンカー情報を用いて，変換transを求める</span>
        
        <span class="c1"># アンカーキーワードから，アンカー比率を返す．</span>
        <span class="k">if</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">anchor_x</span> <span class="o">==</span> <span class="kc">None</span> <span class="ow">and</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">anchor_y</span> <span class="o">==</span> <span class="kc">None</span> <span class="ow">and</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">anchor</span> <span class="o">==</span> <span class="kc">None</span><span class="p">):</span>
            <span class="n">trans</span><span class="p">,</span> <span class="n">box</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">box_native</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">anchor_ratio_x</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">anchor_ratio_y</span> <span class="o">=</span> \
                <span class="n">crt</span><span class="o">.</span><span class="n">get_anchor_ratio</span><span class="p">(</span><span class="n">anchor_x</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">anchor_x</span><span class="p">,</span>
                                     <span class="n">anchor_y</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">anchor_y</span><span class="p">,</span>
                                     <span class="n">anchor</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">anchor</span><span class="p">)</span>
        
            <span class="n">x</span><span class="p">,</span> <span class="n">y</span> <span class="o">=</span> <span class="n">crt</span><span class="o">.</span><span class="n">get_point_by_anchor_ratio</span><span class="p">(</span><span class="n">box_native</span><span class="p">,</span>
                                                 <span class="n">ratio_x</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">anchor_ratio_x</span><span class="p">,</span>
                                                 <span class="n">ratio_y</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">anchor_ratio_y</span><span class="p">)</span>
            <span class="n">com</span><span class="o">.</span><span class="n">ensure</span><span class="p">(</span><span class="nb">isinstance</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="p">(</span><span class="nb">float</span><span class="p">,</span> <span class="nb">int</span><span class="p">))</span> <span class="ow">and</span>
                       <span class="nb">isinstance</span><span class="p">(</span><span class="n">y</span><span class="p">,</span> <span class="p">(</span><span class="nb">float</span><span class="p">,</span> <span class="nb">int</span><span class="p">)),</span>
                       <span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">myinfo</span><span class="p">()</span><span class="si">}</span><span class="s1">.arrange_me_post:&#39;</span><span class="o">+</span>
                       <span class="sa">f</span><span class="s1">&#39; x=</span><span class="si">{</span><span class="n">x</span><span class="si">}</span><span class="s1"> and y=</span><span class="si">{</span><span class="n">y</span><span class="si">}</span><span class="s1"> must be numbers&#39;</span><span class="p">)</span>
            <span class="n">trans</span> <span class="o">=</span> <span class="n">crt</span><span class="o">.</span><span class="n">Translate</span><span class="p">(</span><span class="mf">0.0</span> <span class="o">-</span> <span class="n">x</span><span class="p">,</span> <span class="mf">0.0</span> <span class="o">-</span> <span class="n">y</span><span class="p">)</span> <span class="c1">##新しい変換</span>
            
            <span class="c1">##新しい変換で包含矩形を変換する</span>
            <span class="n">box</span> <span class="o">=</span> <span class="n">crt</span><span class="o">.</span><span class="n">box_apply_trans</span><span class="p">(</span><span class="n">box_native</span><span class="p">,</span> <span class="n">trans</span><span class="o">=</span><span class="n">trans</span><span class="p">)</span>
            <span class="k">if</span> <span class="kc">True</span><span class="p">:</span> <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;@debug:arrange_self_transform:</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">myinfo</span><span class="p">()</span><span class="si">}</span><span class="s1">: ratio=</span><span class="si">{</span> <span class="bp">self</span><span class="o">.</span><span class="n">anchor_ratio_x</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">anchor_ratio_y</span> <span class="si">}</span><span class="s1"> =&gt; x,y=</span><span class="si">{</span><span class="n">x</span><span class="p">,</span><span class="n">y</span><span class="si">}</span><span class="s1"> trans=</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">trans_self</span><span class="si">}</span><span class="s1">: box0=</span><span class="si">{</span><span class="n">box_native</span><span class="si">}</span><span class="s1"> =&gt; box=</span><span class="si">{</span><span class="n">box</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>
        
        <span class="k">return</span> <span class="n">trans</span><span class="p">,</span> <span class="n">box</span></div>

    <span class="k">pass</span> <span class="c1">##class AnchorBoard</span></div>
        
<span class="c1">#=====</span>
<span class="c1"># ボードのインタフェースのクラス</span>
<span class="c1">#=====</span>
<span class="c1">#class Board(PackerBoard):</span>
<div class="viewcode-block" id="Board"><a class="viewcode-back" href="../../board.html#board.cboard.Board">[ドキュメント]</a><span class="k">class</span> <span class="nc">Board</span><span class="p">(</span><span class="n">AnchorBoard</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;画盤（board）のクラス．`AnchorBase`のラッパー．</span>

<span class="sd">    Args: </span>
<span class="sd">          **kwargs : 他のキーワード引数．上位クラスに渡される．</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;画盤オブジェクトを初期化する</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1">#引数</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">verbose</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">repo</span><span class="p">(</span><span class="n">msg</span><span class="o">=</span><span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">myinfo</span><span class="p">()</span><span class="si">}</span><span class="s1">.__init__(): </span><span class="si">{</span> <span class="bp">self</span><span class="o">.</span><span class="n">vars</span><span class="p">()</span> <span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>
        <span class="k">return</span></div>

<span class="c1">#======</span>
<span class="c1">#基盤画像系: exp </span>
<span class="c1">#======</span>
<div class="viewcode-block" id="Canvas"><a class="viewcode-back" href="../../board.html#board.cboard.Canvas">[ドキュメント]</a><span class="k">class</span> <span class="nc">Canvas</span><span class="p">(</span><span class="n">Board</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;トップレベルのボードのクラス．描画のためのCairoのSurfaceを保持する．</span>
<span class="sd">    描画対象のすべての要素（ボード）は，本オブジェクトの子孫として保持する．</span>


<span class="sd">    Args: </span>
<span class="sd">          imgtype (cairo.Format) : Surfaceフォーマット (default: cairo.FORMAT_ARGB32)</span>

<span class="sd">          format (str) : 出力ファイルフォーマット（拡張子 pdf, png）default: &quot;pdf&quot;</span>

<span class="sd">          outfile (str) : 出力ファイル名（拡張子を除く）default: &quot;out&quot;</span>

<span class="sd">          imagesize (str) : 初期の画像サイズ. default: &#39;XGA&#39;        </span>

<span class="sd">          verbose (bool): ログ出力のフラグ．default=False    </span>

<span class="sd">          portrait (bool) : 画像サイズが縦長か？</span>

<span class="sd">          boundingbox (bool)  : デバッグ用: 包含矩形のデバッグ出力をする</span>

<span class="sd">          max_perturb (float) : デバッグ用: 包含矩形の摂動幅</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="c1"># background (string): 背景色．デバッグ用．default=&#39;skyblue&#39;, #debug</span>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span>
                 <span class="n">imgtype</span><span class="o">=</span><span class="n">cairo</span><span class="o">.</span><span class="n">FORMAT_ARGB32</span><span class="p">,</span> <span class="c1">#cairoのSurface format</span>
                 <span class="nb">format</span><span class="o">=</span><span class="s2">&quot;pdf&quot;</span><span class="p">,</span>   <span class="c1">#出力ファイルフォーマット（拡張子 pdf, png）</span>
                 <span class="n">outfile</span><span class="o">=</span><span class="s2">&quot;out&quot;</span><span class="p">,</span>  <span class="c1">#出力ファイル名（拡張子を除く）</span>
                 <span class="n">imagesize</span><span class="o">=</span><span class="s1">&#39;XGA&#39;</span><span class="p">,</span><span class="c1">#初期の画像サイズ</span>
                 <span class="n">portrait</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="c1">#画像サイズが縦長か？</span>
                 <span class="c1">## for debugging</span>
                 <span class="n">boundingbox</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="c1">#デバッグ用: 包含矩形のデバッグ出力をする</span>
                 <span class="n">max_perturb</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>  <span class="c1">#デバッグ用: </span>
                 <span class="c1"># show_origin=None,  #デバッグ用: </span>
                 <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;トップレベルのボードを生成する．描画のためのCairoのSurfaceを保持する．</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1">#基礎クラスの生成子</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="n">dep_init</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span> 
        <span class="c1">#パラメータ</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">imgtype</span>   <span class="o">=</span> <span class="n">imgtype</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">format</span>    <span class="o">=</span> <span class="nb">format</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">outfile</span>   <span class="o">=</span> <span class="n">outfile</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">imagesize</span> <span class="o">=</span> <span class="n">imagesize</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">portrait</span>  <span class="o">=</span> <span class="n">portrait</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">boundingbox</span> <span class="o">=</span> <span class="n">boundingbox</span> <span class="c1">#fetchで子孫からアクセス</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">max_perturb</span> <span class="o">=</span> <span class="n">max_perturb</span> <span class="c1">#fetchで子孫からアクセス</span>
        <span class="c1"># self.show_origin = show_origin #fetchで子孫からアクセス</span>
        <span class="n">verbose</span> <span class="o">=</span> <span class="n">kw</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">kwargs</span><span class="p">,</span> <span class="n">key</span><span class="o">=</span><span class="s1">&#39;verbose&#39;</span><span class="p">,</span> <span class="n">default</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>

        <span class="c1">##属性</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">im</span>    <span class="o">=</span> <span class="kc">None</span>   <span class="c1">#基礎画像オブジェクト．遅延生成</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">display_size</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="c1"># self.verbose = verbose </span>
        
        <span class="k">if</span> <span class="n">verbose</span><span class="p">:</span> 
            <span class="bp">self</span><span class="o">.</span><span class="n">repo</span><span class="p">(</span><span class="n">msg</span><span class="o">=</span><span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">myinfo</span><span class="p">()</span><span class="si">}</span><span class="s1">.__init__(): vars=</span><span class="si">{</span> <span class="bp">self</span><span class="o">.</span><span class="n">vars</span><span class="p">()</span> <span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>

        <span class="c1">#基底描画オブジェクトの生成</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">format</span><span class="p">:</span> <span class="c1">#cairoのformatが与えられていたら，直ちに基底画像pimを生成</span>
            <span class="c1">#画像フォーマット</span>
            <span class="n">com</span><span class="o">.</span><span class="n">ensure</span><span class="p">(</span><span class="nb">format</span><span class="p">,</span> <span class="sa">f</span><span class="s1">&#39;format must be defined!&#39;</span><span class="p">)</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">verbose</span><span class="p">:</span> 
                <span class="bp">self</span><span class="o">.</span><span class="n">repo</span><span class="p">(</span><span class="n">msg</span><span class="o">=</span><span class="sa">f</span><span class="s1">&#39;.create_pim: format=</span><span class="si">{</span> <span class="nb">format</span> <span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>

            <span class="c1">#display_sizeの設定</span>
            <span class="c1">##画像サイズ</span>
            <span class="k">if</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">imagesize</span> <span class="o">==</span> <span class="kc">None</span><span class="p">)</span> <span class="ow">or</span> <span class="p">(</span><span class="ow">not</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">imagesize</span> <span class="ow">in</span> <span class="n">DISPLAY_SHAPE</span><span class="p">)):</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">imagesize</span> <span class="o">=</span> <span class="n">DEFAULT_IMAGE_SIZE</span>
            <span class="n">xsize_</span><span class="p">,</span> <span class="n">ysize_</span> <span class="o">=</span> <span class="n">DISPLAY_SHAPE</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">imagesize</span><span class="p">]</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">portrait</span><span class="p">:</span> <span class="c1">#縦長</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">display_size</span> <span class="o">=</span> <span class="p">(</span><span class="n">ysize_</span><span class="p">,</span> <span class="n">xsize_</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span> <span class="c1">#横長</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">display_size</span> <span class="o">=</span> <span class="p">(</span><span class="n">xsize_</span><span class="p">,</span> <span class="n">ysize_</span><span class="p">)</span>
                
            <span class="bp">self</span><span class="o">.</span><span class="n">im</span> <span class="o">=</span> <span class="n">crt</span><span class="o">.</span><span class="n">ImageBoard</span><span class="p">(</span>
                <span class="c1"># dep_init=self.depth+1, </span>
                <span class="nb">format</span><span class="o">=</span><span class="nb">format</span><span class="p">,</span> 
                <span class="n">outfile</span><span class="o">=</span><span class="n">outfile</span><span class="p">,</span>
                <span class="n">display_size</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">display_size</span><span class="p">,</span> 
                <span class="n">verbose</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">verbose</span><span class="p">,</span> 
            <span class="p">)</span>  <span class="c1">##ImageBoardの生成</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">im</span><span class="o">.</span><span class="n">depth</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">depth</span><span class="o">+</span><span class="mi">1</span>
        <span class="k">return</span> 
        
    <span class="c1">#=====</span>
    <span class="c1"># 基底描画系の生成</span>
    <span class="c1">#=====</span>

<div class="viewcode-block" id="Canvas.canvas_size"><a class="viewcode-back" href="../../board.html#board.cboard.Canvas.canvas_size">[ドキュメント]</a>    <span class="k">def</span> <span class="nf">canvas_size</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">display_size</span></div>

    <span class="c1"># 基本：画像を表示する</span>
<div class="viewcode-block" id="Canvas.show"><a class="viewcode-back" href="../../board.html#board.cboard.Canvas.show">[ドキュメント]</a>    <span class="k">def</span> <span class="nf">show</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">noshow</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">depth</span><span class="o">=</span><span class="mi">0</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;配置と描画を行ない，画像をディスプレイに表示する．</span>
<span class="sd">        次の手順で描画する．</span>

<span class="sd">        - ステップ1: 再帰的に子オブジェクトへ _arrange() 命令を送り，ボトムアップに配置の包含矩形 box を計算する</span>
<span class="sd">        - ステップ2: 包含矩形情報 box を元に，self.create_pim() 命令を発行して，pillowの画像盤 self.im を生成する．</span>
<span class="sd">        - ステップ3: 再帰的に draw() 命令を発行して，トップダウンに描画を行う</span>
<span class="sd">        - ステップ4: 自身のもつpillowオブジェクト self.imに show() 命令を送り，画像を表示する</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">verbose</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">repo</span><span class="p">(</span><span class="n">msg</span><span class="o">=</span><span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">myinfo</span><span class="p">()</span><span class="si">}</span><span class="s1">.show(): </span><span class="si">{</span> <span class="bp">self</span><span class="o">.</span><span class="n">vars</span><span class="p">()</span> <span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>
        
        <span class="c1">#ステップ1: ボトムアップに配置を計算する</span>
        <span class="n">box</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_arrange</span><span class="p">()</span>
        <span class="n">com</span><span class="o">.</span><span class="n">ensure</span><span class="p">(</span><span class="n">box</span><span class="p">,</span> <span class="s1">&#39;self.shape_pt must be defined!&#39;</span><span class="p">)</span>

        <span class="c1">#ステップ2: トップダウンに描画を行う</span>
        <span class="n">cr</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">im</span><span class="o">.</span><span class="n">context</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_draw</span><span class="p">(</span><span class="n">cr</span><span class="p">)</span>
        
        <span class="c1">#ステップ3: 画像を表示する</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">im</span><span class="o">.</span><span class="n">show</span><span class="p">(</span><span class="n">noshow</span><span class="o">=</span><span class="n">noshow</span><span class="p">)</span>  <span class="c1">##pilimage.ImageBoard</span>
        <span class="c1"># self.im.show(noshow=noshow, depth=depth)  ##pilimage.ImageBoard</span>
        <span class="k">return</span></div>

    <span class="c1">#Cairo.contextオブジェクトの返却</span>
<div class="viewcode-block" id="Canvas.context"><a class="viewcode-back" href="../../board.html#board.cboard.Canvas.context">[ドキュメント]</a>    <span class="k">def</span> <span class="nf">context</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span> 
        <span class="sd">&quot;&quot;&quot;Cairo.contextオブジェクトを返す．&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">im</span><span class="o">.</span><span class="n">context</span><span class="p">()</span>  <span class="c1">##Cairo.contextオブジェクト</span></div>
            
    <span class="c1"># 画像をファイルに保存する</span>
<div class="viewcode-block" id="Canvas.save"><a class="viewcode-back" href="../../board.html#board.cboard.Canvas.save">[ドキュメント]</a>    <span class="k">def</span> <span class="nf">save</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">imgfile</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;imgfile: 保存する画像ファイルの名前．&quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">im</span><span class="o">.</span><span class="n">save</span><span class="p">(</span><span class="n">imgfile</span><span class="o">=</span><span class="n">imgfile</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
        <span class="k">return</span></div></div>

<span class="c1">#=====</span>
<span class="c1"># ラッパーのクラス</span>
<span class="c1">#=====</span>
<div class="viewcode-block" id="WrapperBoard"><a class="viewcode-back" href="../../board.html#board.cboard.WrapperBoard">[ドキュメント]</a><span class="k">class</span> <span class="nc">WrapperBoard</span><span class="p">(</span><span class="n">BoardBase</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;ラッパーのクラス．唯一の子をもち，指定された以外のメソッド呼び出しを子に転送する．</span>

<span class="sd">    Args: </span>
<span class="sd">          **kwargs : 他のキーワード引数．上位クラスに渡される．</span>

<span class="sd">    Attributes: </span>
<span class="sd">        verbose (bool): ログ出力のフラグ</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">child</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;画盤オブジェクトを初期化する</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1">#引数</span>
        <span class="c1">#親Loggableの初期化</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="n">max_children</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="c1">#Can have at most one child</span>
                         <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
        <span class="n">com</span><span class="o">.</span><span class="n">ensure</span><span class="p">(</span><span class="n">child</span> <span class="o">!=</span> <span class="kc">None</span><span class="p">,</span> <span class="sa">f</span><span class="s1">&#39;child must be to None!&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">put</span><span class="p">(</span><span class="n">trans</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">child</span><span class="o">=</span><span class="n">child</span><span class="p">)</span>   <span class="c1">#子に追加</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">the_child</span> <span class="o">=</span> <span class="n">child</span>  <span class="c1">#転送先オブジェクト</span>
        <span class="c1">#内部変数</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">verbose</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">repo</span><span class="p">(</span><span class="n">msg</span><span class="o">=</span><span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">myinfo</span><span class="p">()</span><span class="si">}</span><span class="s1">.__init__(): </span><span class="si">{</span> <span class="bp">self</span><span class="o">.</span><span class="n">vars</span><span class="p">()</span> <span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>
        <span class="k">return</span>

    <span class="c1"># Override exp 基本：配置の計算</span>
    <span class="k">def</span> <span class="nf">_arrange</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;配置を計算する．配置は，ボトムアップに再帰的に計算される．</span>

<span class="sd">        Args: </span>

<span class="sd">        Returns: </span>
<span class="sd">        	rect: 計算済みの自身の包含矩形オブジェクト</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">verbose</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">repo</span><span class="p">(</span><span class="n">msg</span><span class="o">=</span><span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">myinfo</span><span class="p">()</span><span class="si">}</span><span class="s1">._arrange(): </span><span class="si">{</span> <span class="bp">self</span><span class="o">.</span><span class="n">vars</span><span class="p">()</span> <span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>

        <span class="k">for</span> <span class="n">idx</span><span class="p">,</span> <span class="n">pair</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">children_enumerated</span><span class="p">():</span>
            <span class="n">trans</span><span class="p">,</span> <span class="n">child</span> <span class="o">=</span> <span class="n">pair</span> <span class="c1">#分解</span>
            <span class="c1">#子の型チェック</span>
            <span class="n">com</span><span class="o">.</span><span class="n">ensure</span><span class="p">(</span><span class="nb">isinstance</span><span class="p">(</span><span class="n">child</span><span class="p">,</span> <span class="n">BoardBase</span><span class="p">),</span>
                       <span class="s1">&#39;child must be a subclass of BoardBase!: </span><span class="si">{child}</span><span class="s1">&#39;</span><span class="p">)</span>
            <span class="c1">#子の再帰処理</span>
            <span class="n">child_box</span> <span class="o">=</span> <span class="n">child</span><span class="o">.</span><span class="n">_arrange</span><span class="p">()</span>
            <span class="n">x0</span><span class="p">,</span> <span class="n">y0</span><span class="p">,</span> <span class="n">x1</span><span class="p">,</span> <span class="n">y1</span> <span class="o">=</span> <span class="n">child_box</span>
			
			<span class="c1">#自身の包含矩形とアンカーを，左上を原点にそろえて，正規化する．</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">trans_self</span> <span class="o">=</span> <span class="n">crt</span><span class="o">.</span><span class="n">Translate</span><span class="p">((</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span><span class="o">*</span><span class="n">x0</span><span class="p">,</span> <span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span><span class="o">*</span><span class="n">y0</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">box_self</span> <span class="o">=</span> <span class="n">crt</span><span class="o">.</span><span class="n">box_apply_trans</span><span class="p">(</span><span class="n">child_box</span><span class="p">,</span> <span class="n">trans</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">trans_self</span><span class="p">)</span>
                
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">verbose</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">repo</span><span class="p">(</span><span class="n">msg</span><span class="o">=</span><span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">myinfo</span><span class="p">()</span><span class="si">}</span><span class="s1">._arrange()=&gt; box=</span><span class="si">{</span> <span class="n">boxes</span> <span class="si">}</span><span class="s1">&#39;</span><span class="p">,</span> <span class="n">isChild</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">box_self</span> 

    <span class="c1">#=====</span>
    <span class="c1">## メソッド転送</span>
    <span class="c1">#=====</span>
    <span class="k">def</span> <span class="fm">__getattr__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;メソッドが未定義のとき，呼び出される特殊関数．</span>
<span class="sd">		未定義の属性呼び出しのときも呼ばれるので注意．</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">verbose</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;</span><span class="se">\t</span><span class="s1">@WrapperBoard: method=&quot;__getattr__&quot; is called&#39;</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">bc</span><span class="o">.</span><span class="n">BackupCaller</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">the_child</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span> <span class="n">verbose</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span></div>

    <span class="c1">#=====</span>
    <span class="c1"># 子のリスト</span>
    <span class="c1">#=====</span>
    
<span class="c1">#=====</span>
<span class="c1"># ボードの実装クラス</span>
<span class="c1">#=====</span>
<span class="c1"># class PackerBoard(AnchorBoard):</span>
<div class="viewcode-block" id="PackerBoard"><a class="viewcode-back" href="../../board.html#board.cboard.PackerBoard">[ドキュメント]</a><span class="k">class</span> <span class="nc">PackerBoard</span><span class="p">(</span><span class="n">Board</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;画盤（board）のクラス．Boardのサブクラス</span>

<span class="sd">    Args: </span>
<span class="sd">         align (str) : 並べる主軸方向の指定．`x`または`y`の値をとる．default=&#39;x&#39;</span>

<span class="sd">         margin_x (float) : 子セルそれぞれの周囲のx方向の余白．default=None．</span>

<span class="sd">         margin_y (float) : 子セルそれぞれの周囲のy方向の余白．default=None</span>

<span class="sd">         margin (float) : 子セルそれぞれの周囲のx方向とy方向の余白．default=None, </span>

<span class="sd">         pack_anchor (str) : 主軸方向の子のアンカー指定．引数`align`が，`x`の場合は`y`方向の子のアンカー指定については，alignの値`(True, False)`に従って，次のように強制される．</span>

<span class="sd">             + パックする場合(pack==True)は，先頭から詰めて配置するため，先頭寄せにする．</span>
<span class="sd">             + パックしない場合(pack==False)は，両側が均等に空くように中央寄せにする </span>

<span class="sd">         expand (bool) : 子を拡張するかどうかのフラグ．default=False. もし`expand=True`の場合は，主軸方向のサイズが定義されている必要がある．具体的には，次の制約を満たすこと．</span>
<span class="sd">    </span>
<span class="sd">             + `align==&#39;x&#39;`ならば`width != None`を満たすこと．</span>
<span class="sd">             + `align==&#39;y&#39;`ならば`height != None`を満たすこと．</span>

<span class="sd">         width (float) : 自身の幅．default=None. </span>

<span class="sd">         height (float) : 自身の高さ．default=None. </span>

<span class="sd">    	 kwargs : 他のキーワード引数．上位クラスに渡される．</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span>
                 <span class="n">align</span><span class="o">=</span><span class="s1">&#39;x&#39;</span><span class="p">,</span>
                 <span class="c1"># pack=False,</span>
                 <span class="n">margin_x</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> 
                 <span class="n">margin_y</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> 
                 <span class="n">margin</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> 
                 <span class="n">pack_anchor</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
                 <span class="c1">##</span>
                 <span class="n">expand</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
                 <span class="n">width</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
                 <span class="n">height</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> 
                 <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="c1">#引数</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
        <span class="c1">#内部変数</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">align</span> <span class="o">=</span> <span class="n">align</span>
        <span class="c1">## マージン設定</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_set_margin_x_and_y</span><span class="p">(</span><span class="n">margin</span><span class="p">,</span> <span class="n">margin_x</span><span class="p">,</span> <span class="n">margin_y</span><span class="p">)</span> 
        <span class="bp">self</span><span class="o">.</span><span class="n">pack_anchor</span> <span class="o">=</span> <span class="n">pack_anchor</span>
        <span class="c1"># self.pack_anchor_x = None </span>
        <span class="c1"># self.pack_anchor_y = None</span>
        <span class="c1">#size</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">width</span> <span class="o">=</span><span class="n">width</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">height</span><span class="o">=</span><span class="n">height</span>
        <span class="c1">#expand</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">expand</span><span class="o">=</span><span class="n">expand</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">expand</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">align</span> <span class="ow">in</span> <span class="p">(</span><span class="s1">&#39;x&#39;</span><span class="p">):</span>
                <span class="n">com</span><span class="o">.</span><span class="n">ensure</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">width</span><span class="o">!=</span><span class="kc">None</span><span class="p">,</span> <span class="sa">f</span><span class="s1">&#39;align=x: width==None!&#39;</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">com</span><span class="o">.</span><span class="n">ensure</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">height</span><span class="o">!=</span><span class="kc">None</span><span class="p">,</span> <span class="sa">f</span><span class="s1">&#39;align=y: height==None!&#39;</span><span class="p">)</span>
        
        <span class="c1">#debug</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">pack_done</span> <span class="o">=</span> <span class="kc">False</span>
                        
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">verbose</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">repo</span><span class="p">(</span><span class="n">msg</span><span class="o">=</span><span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">myinfo</span><span class="p">()</span><span class="si">}</span><span class="s1">.__init__(): </span><span class="si">{</span> <span class="bp">self</span><span class="o">.</span><span class="n">vars</span><span class="p">()</span> <span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>
        <span class="k">return</span>

    <span class="k">def</span> <span class="nf">_set_margin_x_and_y</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">margin</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">margin_x</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">margin_y</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;マージン設定&quot;&quot;&quot;</span>
        <span class="n">_margin</span> <span class="o">=</span> <span class="n">com</span><span class="o">.</span><span class="n">ensure_defined</span><span class="p">(</span><span class="n">value</span><span class="o">=</span><span class="n">margin</span><span class="p">,</span> <span class="n">default</span><span class="o">=</span><span class="mf">0.0</span><span class="p">)</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">align</span> <span class="ow">in</span> <span class="p">(</span><span class="s1">&#39;x&#39;</span><span class="p">):</span> 
            <span class="bp">self</span><span class="o">.</span><span class="n">margin_y</span> <span class="o">=</span> <span class="n">margin_y</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">margin_x</span> <span class="o">=</span> <span class="n">com</span><span class="o">.</span><span class="n">ensure_defined</span><span class="p">(</span><span class="n">value</span><span class="o">=</span><span class="n">margin_x</span><span class="p">,</span> <span class="n">default</span><span class="o">=</span><span class="n">_margin</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span> <span class="c1">## self.align in (&#39;y&#39;): </span>
            <span class="bp">self</span><span class="o">.</span><span class="n">margin_x</span> <span class="o">=</span> <span class="n">margin_x</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">margin_y</span> <span class="o">=</span> <span class="n">com</span><span class="o">.</span><span class="n">ensure_defined</span><span class="p">(</span><span class="n">value</span><span class="o">=</span><span class="n">margin_y</span><span class="p">,</span> <span class="n">default</span><span class="o">=</span><span class="n">_margin</span><span class="p">)</span>
        <span class="k">return</span> 
    
    <span class="c1"># exp 基本：子を追加する</span>
<div class="viewcode-block" id="PackerBoard.add"><a class="viewcode-back" href="../../board.html#board.cboard.PackerBoard.add">[ドキュメント]</a>    <span class="k">def</span> <span class="nf">add</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">child</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span> 
        <span class="sd">&quot;&quot;&quot;子を追加する．関数`BoardBase.put(child, trans=None)`へのラッパー関数．</span>

<span class="sd">        Args: </span>
<span class="sd">            child (Board): 子として追加するBoardオブジェクト</span>

<span class="sd">        Returns:</span>
<span class="sd">            (Board) : 追加した子</span>
<span class="sd">        </span>
<span class="sd">        Example::</span>
<span class="sd">        </span>
<span class="sd">        		root = Canvas()</span>
<span class="sd">        		parent= root.put(Board())</span>
<span class="sd">        		child = parent.add(Rectangle())</span>
<span class="sd">        		child = parent.add(Circle())</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">com</span><span class="o">.</span><span class="n">ensure</span><span class="p">(</span><span class="n">child</span> <span class="o">!=</span> <span class="kc">None</span><span class="p">,</span> <span class="sa">f</span><span class="s1">&#39;child must be to None!&#39;</span><span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;@debug: self=</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">myinfo</span><span class="p">(</span><span class="n">depth</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span><span class="si">}</span><span class="s1"> child=</span><span class="si">{</span><span class="n">child</span><span class="o">.</span><span class="n">myinfo</span><span class="p">(</span><span class="n">depth</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>
        <span class="n">wrapper</span> <span class="o">=</span> <span class="n">WrapperBoard</span><span class="p">(</span><span class="n">child</span><span class="o">=</span><span class="n">child</span><span class="p">)</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">put</span><span class="p">(</span><span class="n">trans</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">child</span><span class="o">=</span><span class="n">wrapper</span><span class="p">)</span></div>

    <span class="c1"># 基本：子画盤の並びを返す</span>
    <span class="c1">##Override</span>
<div class="viewcode-block" id="PackerBoard.children_box_enumerated"><a class="viewcode-back" href="../../board.html#board.cboard.PackerBoard.children_box_enumerated">[ドキュメント]</a>    <span class="k">def</span> <span class="nf">children_box_enumerated</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;添字とエントリの対`idx, triple`の並び children を返す．</span>
<span class="sd">        現在は，`triple`は，三つ組`trans, child, child_box`である．必要なら部分クラスで上書きする．</span>

<span class="sd">        Returns: </span>
<span class="sd">             (list): 三つ組`trans (GeoTransform)`, `child (BoardBase)`, child_box (tuple(float,float,float,float))`のリスト．</span>
<span class="sd">          </span>
<span class="sd">        Notes: </span>
<span class="sd">          </span>
<span class="sd">              ただし，childはNoneでないことを保証し，そうでないときはErrorを投げる．</span>
<span class="sd">              transとchild_boxはNoneでも良い．</span>
<span class="sd">          &quot;&quot;&quot;</span>
        <span class="n">idx</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="k">for</span> <span class="n">trans</span><span class="p">,</span> <span class="n">child</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">children_</span><span class="p">:</span>
            <span class="c1">#子の型チェック</span>
            <span class="n">com</span><span class="o">.</span><span class="n">ensure</span><span class="p">(</span><span class="nb">isinstance</span><span class="p">(</span><span class="n">child</span><span class="p">,</span> <span class="n">BoardBase</span><span class="p">),</span>
                       <span class="s1">&#39;child must be a subclass of BoardBase!: </span><span class="si">{child}</span><span class="s1">&#39;</span><span class="p">)</span>
            <span class="n">child_box</span> <span class="o">=</span> <span class="n">child</span><span class="o">.</span><span class="n">get_box</span><span class="p">()</span>
            <span class="n">triple</span> <span class="o">=</span> <span class="n">trans</span><span class="p">,</span> <span class="n">child</span><span class="p">,</span> <span class="n">child_box</span>
            <span class="k">yield</span> <span class="n">idx</span><span class="p">,</span> <span class="n">triple</span>
            <span class="n">idx</span> <span class="o">+=</span> <span class="mi">1</span></div>

    <span class="k">def</span> <span class="nf">_accumulate_boxes</span><span class="p">(</span><span class="n">boxes</span><span class="p">):</span> 
        <span class="sd">&quot;&quot;&quot;包含矩形のリストを受け取り，要素である包含矩形を走査して，</span>
<span class="sd">        サイズの最大と総和を求める副関数</span>
<span class="sd">        </span>
<span class="sd">        Args: </span>
<span class="sd">             boxes (list(Box)) : 包含矩形の並び（リスト or iterator）</span>

<span class="sd">        Returns: </span>
<span class="sd">             MAXSZ (tuple(float, float)) : 矩形のx-とy-サイズの最大値の対</span>
<span class="sd">             SUMSZ (tuple(float, float)) : 矩形x-とy-のサイズの総和の対</span>
<span class="sd">             NUM (int) : 矩形の数</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">MAXSZ</span> <span class="o">=</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span> <span class="c1">#サイズの最大値</span>
        <span class="n">SUMSZ</span> <span class="o">=</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span> <span class="c1">#サイズの総和</span>
        <span class="n">NUM</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="c1"># for idx, triple in self.children_box_enumerated():</span>
        <span class="k">for</span> <span class="n">idx</span><span class="p">,</span> <span class="n">triple</span> <span class="ow">in</span> <span class="n">boxes</span><span class="p">:</span>
            <span class="n">trans</span><span class="p">,</span> <span class="n">child</span><span class="p">,</span> <span class="n">child_box</span> <span class="o">=</span> <span class="n">triple</span> <span class="c1">#分解</span>
            <span class="n">com</span><span class="o">.</span><span class="n">ensure</span><span class="p">(</span><span class="n">child_box</span> <span class="o">!=</span> <span class="kc">None</span><span class="p">,</span>
                       <span class="sa">f</span><span class="s1">&#39;child_box=</span><span class="si">{</span><span class="n">child_box</span><span class="si">}</span><span class="s1"> must be non-None&#39;</span><span class="p">)</span>
            <span class="c1">#子の包含矩形の最大サイズを更新</span>
            <span class="n">cwidth0</span><span class="p">,</span> <span class="n">cwidth1</span>  <span class="o">=</span> <span class="n">crt</span><span class="o">.</span><span class="n">box_shape</span><span class="p">(</span><span class="n">child_box</span><span class="p">)</span>
            <span class="n">MAXSZ</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">MAXSZ</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="n">MAXSZ</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span><span class="n">cwidth0</span><span class="p">),</span> <span class="nb">max</span><span class="p">(</span><span class="n">MAXSZ</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span><span class="n">cwidth1</span><span class="p">)</span>
            <span class="n">SUMSZ</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">SUMSZ</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="n">SUMSZ</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">+</span> <span class="n">cwidth0</span><span class="p">,</span> <span class="n">SUMSZ</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">+</span> <span class="n">cwidth1</span>
            <span class="n">NUM</span> <span class="o">+=</span> <span class="mi">1</span>
        <span class="k">return</span> <span class="n">MAXSZ</span><span class="p">,</span> <span class="n">SUMSZ</span><span class="p">,</span> <span class="n">NUM</span>

    <span class="c1"># def _accumulate_boxes(self): </span>
    <span class="c1">#     &quot;&quot;&quot;子の包含矩形のサイズの最大と総和を求める副関数&quot;&quot;&quot;</span>
    <span class="c1">#     MAXSZ = [0, 0] #サイズの最大値</span>
    <span class="c1">#     SUMSZ = [0, 0] #サイズの総和</span>
    <span class="c1">#     num_children = 0</span>
    <span class="c1">#     for idx, triple in self.children_box_enumerated():</span>
    <span class="c1">#         trans, child, child_box = triple #分解</span>
    <span class="c1">#         com.ensure(child_box != None,</span>
    <span class="c1">#                    f&#39;child_box={child_box} must be non-None&#39;)</span>
    <span class="c1">#         #子の包含矩形の最大サイズを更新</span>
    <span class="c1">#         cwidth0, cwidth1  = crt.box_shape(child_box)</span>
    <span class="c1">#         MAXSZ[0], MAXSZ[1] = max(MAXSZ[0],cwidth0), max(MAXSZ[1],cwidth1)</span>
    <span class="c1">#         SUMSZ[0], SUMSZ[1] = SUMSZ[0] + cwidth0, SUMSZ[1] + cwidth1</span>
    <span class="c1">#         num_children += 1</span>
    <span class="c1">#     return MAXSZ[0], MAXSZ[1], SUMSZ[0], SUMSZ[1], num_children</span>

    <span class="k">def</span> <span class="nf">_sub_child_dup</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">child_new</span><span class="p">,</span> <span class="n">child</span><span class="p">,</span> <span class="n">width</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">height</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span> 
        <span class="n">child_new</span><span class="o">.</span><span class="n">ord_</span> <span class="o">=</span> <span class="n">child</span><span class="o">.</span><span class="n">ord_</span>
        <span class="n">child_new</span><span class="o">.</span><span class="n">box_self</span> <span class="o">=</span> <span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">width</span><span class="p">,</span> <span class="n">height</span><span class="p">)</span>
        <span class="n">child_new</span><span class="o">.</span><span class="n">anchor_x</span> <span class="o">=</span> <span class="n">child</span><span class="o">.</span><span class="n">anchor_x</span>
        <span class="n">child_new</span><span class="o">.</span><span class="n">anchor_y</span> <span class="o">=</span> <span class="n">child</span><span class="o">.</span><span class="n">anchor_y</span>
        <span class="n">child_new</span><span class="o">.</span><span class="n">anchor</span> <span class="o">=</span> <span class="n">child</span><span class="o">.</span><span class="n">anchor</span>
        <span class="k">return</span>

    <span class="c1">#To be Override</span>
    <span class="k">def</span> <span class="nf">_arrange_pack</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">boxes_last</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
                      <span class="c1"># expand=False, </span>
                      <span class="c1"># max_length=None,</span>
                      <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;実装関数．自身と子の描画配置情報を計算する．Boardクラスの同名関数のオーバーライド．</span>

<span class="sd">        Args: </span>

<span class="sd">        Note: </span>

<span class="sd">        * 現状では，boxes_lastは用いていない．</span>

<span class="sd">        TODO: </span>
<span class="sd">        次の拡張モードは，後日実装予定．</span>

<span class="sd">          expand (bool) : 真ならば拡張モードで，self.packの値によらず，max_lengthを子の数で当分割して配置する．</span>
<span class="sd">          max_length (float) : 主軸方向の固定長さ</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># com.ensure(self.pack_done == False,</span>
        <span class="c1">#            f&#39;{self.myinfo()}.arrange_me_pack: Executed twice!&#39;)</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">pack_done</span><span class="p">:</span> 
            <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">myinfo</span><span class="p">()</span><span class="si">}</span><span class="s1">.arrange_me_pack: Executed twice and skip!&#39;</span><span class="p">)</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">box_self</span>
        
        <span class="c1">## 軸の設定: Primary, secondary</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">align</span> <span class="ow">in</span> <span class="p">(</span><span class="s1">&#39;x&#39;</span><span class="p">):</span>   <span class="n">AX_PRI</span><span class="p">,</span> <span class="n">AX_SEC</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span>
        <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">align</span> <span class="ow">in</span> <span class="p">(</span><span class="s1">&#39;y&#39;</span><span class="p">):</span> <span class="n">AX_PRI</span><span class="p">,</span> <span class="n">AX_SEC</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">0</span>
        <span class="k">else</span><span class="p">:</span> <span class="n">com</span><span class="o">.</span><span class="n">panic</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;no such align=</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">align</span><span class="si">}</span><span class="s1">!&#39;</span><span class="p">)</span>

        <span class="c1">#作業変数の初期化</span>
        <span class="n">MYSZ</span><span class="o">=</span> <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">width</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">height</span><span class="p">]</span>
        <span class="n">POS</span> <span class="o">=</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span> <span class="c1">#配置位置</span>
        <span class="n">INC</span> <span class="o">=</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span> <span class="c1">#増分</span>
        <span class="n">MAR</span> <span class="o">=</span> <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">margin_x</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">margin_y</span><span class="p">]</span> <span class="c1">#余白</span>

        <span class="c1">## PackAnchor 子の配置のアンカー調整</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">pack_anchor</span> <span class="o">=</span> <span class="n">com</span><span class="o">.</span><span class="n">ensure_defined</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">pack_anchor</span><span class="p">,</span> <span class="n">default</span><span class="o">=</span><span class="s1">&#39;mid&#39;</span><span class="p">)</span>
        <span class="n">PANC</span> <span class="o">=</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span> <span class="c1">#リスト</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">expand</span><span class="p">:</span> 
            <span class="n">PANC</span><span class="p">[</span><span class="n">AX_PRI</span><span class="p">],</span> <span class="n">PANC</span><span class="p">[</span><span class="n">AX_SEC</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;beg&#39;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">pack_anchor</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">PANC</span><span class="p">[</span><span class="n">AX_PRI</span><span class="p">],</span> <span class="n">PANC</span><span class="p">[</span><span class="n">AX_SEC</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;mid&#39;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">pack_anchor</span>
        
        <span class="c1"># 第1回目のパス: 子の包含矩形のサイズの最大と総和を求める</span>
        <span class="n">MAXSZ</span><span class="p">,</span> <span class="n">SUMSZ</span><span class="p">,</span> <span class="n">NUM</span> <span class="o">=</span> <span class="n">PackerBoard</span><span class="o">.</span><span class="n">_accumulate_boxes</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">children_box_enumerated</span><span class="p">())</span>
        <span class="c1">#配置の増分を求める</span>
        <span class="n">is_expand_mode</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="n">_size</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">expand</span> <span class="ow">and</span> <span class="p">(</span><span class="n">MYSZ</span><span class="p">[</span><span class="n">AX_PRI</span><span class="p">]</span> <span class="o">!=</span> <span class="kc">None</span><span class="p">)</span> <span class="ow">and</span> <span class="n">MYSZ</span><span class="p">[</span><span class="n">AX_PRI</span><span class="p">]</span> <span class="o">/</span> <span class="n">NUM</span> <span class="o">&gt;=</span> <span class="n">MAXSZ</span><span class="p">[</span><span class="n">AX_PRI</span><span class="p">]:</span> 
            <span class="n">_size</span> <span class="o">=</span> <span class="n">MYSZ</span><span class="p">[</span><span class="n">AX_PRI</span><span class="p">]</span> <span class="o">/</span> <span class="n">NUM</span>
            <span class="n">is_expand_mode</span> <span class="o">=</span> <span class="kc">True</span>
            <span class="n">INC</span><span class="p">[</span><span class="n">AX_PRI</span><span class="p">]</span> <span class="o">=</span> <span class="n">_size</span> <span class="c1">#十分な長さがある</span>
        <span class="c1"># elif self.pack: ## 子を詰め込む</span>
        <span class="c1">#     pass ##あとで動的に設定する</span>
        <span class="k">else</span><span class="p">:</span> <span class="c1">## 最大サイズで子を等間隔に置く</span>
            <span class="n">INC</span><span class="p">[</span><span class="n">AX_PRI</span><span class="p">]</span> <span class="o">=</span> <span class="n">MAXSZ</span><span class="p">[</span><span class="n">AX_PRI</span><span class="p">]</span>
        
        <span class="c1">##設定</span>
        <span class="n">RATIO</span> <span class="o">=</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span> <span class="c1">#アンカー比率ratio</span>
        <span class="n">RATIO</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">kw</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">crt</span><span class="o">.</span><span class="n">ALIGN_X</span><span class="p">,</span> <span class="n">key</span><span class="o">=</span><span class="n">PANC</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">required</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
        <span class="n">RATIO</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="n">kw</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">crt</span><span class="o">.</span><span class="n">ALIGN_Y</span><span class="p">,</span> <span class="n">key</span><span class="o">=</span><span class="n">PANC</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">required</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
        <span class="n">POS</span><span class="p">[</span><span class="n">AX_SEC</span><span class="p">]</span> <span class="o">=</span> <span class="n">MAXSZ</span><span class="p">[</span><span class="n">AX_SEC</span><span class="p">]</span> <span class="o">*</span> <span class="n">RATIO</span><span class="p">[</span><span class="n">AX_SEC</span><span class="p">]</span> <span class="c1">#アンカー比率での内分点</span>

        <span class="c1"># 第2回目のパス</span>
        <span class="n">boxes</span> <span class="o">=</span> <span class="n">EMPTY_RECT</span> <span class="c1">#包含矩形の初期値</span>
        <span class="n">children_new_</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">idx</span><span class="p">,</span> <span class="n">triple</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">children_box_enumerated</span><span class="p">():</span>
            <span class="n">trans</span><span class="p">,</span> <span class="n">child</span><span class="p">,</span> <span class="n">child_box</span> <span class="o">=</span> <span class="n">triple</span> <span class="c1">#分解</span>

            <span class="c1">#expand mode</span>
            <span class="k">if</span> <span class="n">is_expand_mode</span><span class="p">:</span> 
                <span class="k">if</span> <span class="kc">True</span><span class="p">:</span> <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;@debug:expandmode:</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">myinfo</span><span class="p">()</span><span class="si">}</span><span class="s1"> </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">align</span><span class="si">}</span><span class="s1"> =&gt; child=</span><span class="si">{</span><span class="n">child</span><span class="o">.</span><span class="n">myinfo</span><span class="p">()</span><span class="si">}</span><span class="s1">: INC[AX_PRI]=</span><span class="si">{</span><span class="n">INC</span><span class="p">[</span><span class="n">AX_PRI</span><span class="p">]</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>
                <span class="n">MAR</span><span class="p">[</span><span class="n">AX_PRI</span><span class="p">]</span> <span class="o">=</span> <span class="mf">0.0</span>
                <span class="c1">## 拡張された箱サイズBOXSZを求める</span>
                <span class="n">BOXSZ</span> <span class="o">=</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span>
                <span class="n">BOXSZ</span><span class="p">[</span><span class="n">AX_PRI</span><span class="p">]</span> <span class="o">=</span> <span class="n">INC</span><span class="p">[</span><span class="n">AX_PRI</span><span class="p">]</span>  <span class="c1">#主軸方向の増分</span>
                <span class="k">if</span> <span class="n">MYSZ</span><span class="p">[</span><span class="n">AX_SEC</span><span class="p">]</span> <span class="o">!=</span> <span class="kc">None</span><span class="p">:</span> 
                    <span class="n">BOXSZ</span><span class="p">[</span><span class="n">AX_SEC</span><span class="p">]</span> <span class="o">=</span> <span class="n">MYSZ</span><span class="p">[</span><span class="n">AX_SEC</span><span class="p">]</span> <span class="c1">#副軸方向の親の幅</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">BOXSZ</span><span class="p">[</span><span class="n">AX_SEC</span><span class="p">]</span> <span class="o">=</span> <span class="n">MAXSZ</span><span class="p">[</span><span class="n">AX_SEC</span><span class="p">]</span>
                
                <span class="c1">#=================</span>
                <span class="c1">## exp 暫定的: childを複製する．</span>
                <span class="n">child_new</span> <span class="o">=</span> <span class="n">Board</span><span class="p">(</span><span class="n">show_origin</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
                                  <span class="n">rgb_origin</span><span class="o">=</span><span class="n">crt</span><span class="o">.</span><span class="n">MYCOL</span><span class="p">[</span><span class="s1">&#39;blue&#39;</span><span class="p">],</span>
                                  <span class="n">angle_origin</span><span class="o">=</span><span class="p">(</span><span class="n">math</span><span class="o">.</span><span class="n">pi</span><span class="o">/</span><span class="mi">4</span><span class="p">)</span><span class="o">*</span><span class="mi">0</span><span class="p">,</span>
                                  <span class="n">show_box</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
                                  <span class="n">rgb_box</span><span class="o">=</span><span class="n">crt</span><span class="o">.</span><span class="n">MYCOL</span><span class="p">[</span><span class="s1">&#39;blue&#39;</span><span class="p">])</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_sub_child_dup</span><span class="p">(</span><span class="n">child_new</span><span class="p">,</span> <span class="n">child</span><span class="p">,</span>
                                    <span class="n">width</span><span class="o">=</span><span class="n">BOXSZ</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">height</span><span class="o">=</span><span class="n">BOXSZ</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
                <span class="n">x1</span><span class="p">,</span> <span class="n">y1</span> <span class="o">=</span> <span class="n">child_new</span><span class="o">.</span><span class="n">get_anchor_point</span><span class="p">(</span><span class="n">anchor_x</span><span class="o">=</span><span class="n">child</span><span class="o">.</span><span class="n">anchor_x</span><span class="p">,</span> <span class="n">anchor_y</span><span class="o">=</span><span class="n">child</span><span class="o">.</span><span class="n">anchor_y</span><span class="p">,</span> <span class="n">anchor</span><span class="o">=</span><span class="n">child</span><span class="o">.</span><span class="n">anchor</span><span class="p">)</span>                
                <span class="n">child</span><span class="o">.</span><span class="n">parent</span> <span class="o">=</span> <span class="kc">None</span> <span class="c1">##exp 破壊的代入につき，要注意!</span>
                <span class="n">child_new</span><span class="o">.</span><span class="n">put</span><span class="p">(</span><span class="n">trans</span><span class="o">=</span><span class="n">crt</span><span class="o">.</span><span class="n">Translate</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">),</span>
                          <span class="n">child</span><span class="o">=</span><span class="n">child</span><span class="p">)</span>
                <span class="n">child</span> <span class="o">=</span> <span class="n">child_new</span>
                <span class="n">child_new</span><span class="o">.</span><span class="n">arrange_me</span><span class="p">()</span>
                <span class="c1">#=================</span>

            <span class="c1">#子のアンカー位置を上書き</span>
            <span class="n">child</span><span class="o">.</span><span class="n">anchor_x</span><span class="p">,</span> <span class="n">child</span><span class="o">.</span><span class="n">anchor_y</span> <span class="o">=</span> <span class="n">PANC</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">PANC</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
            <span class="n">child</span><span class="o">.</span><span class="n">_arrange</span><span class="p">()</span> <span class="c1">#exp</span>
            <span class="n">child_box</span> <span class="o">=</span> <span class="n">child</span><span class="o">.</span><span class="n">get_box</span><span class="p">()</span>
            <span class="k">if</span> <span class="kc">True</span><span class="p">:</span> <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;@debug:pack:align=</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">align</span><span class="si">}</span><span class="s1"> =&gt; child=</span><span class="si">{</span><span class="n">child</span><span class="o">.</span><span class="n">myinfo</span><span class="p">()</span><span class="si">}</span><span class="s1">.anchor=</span><span class="si">{</span><span class="n">child</span><span class="o">.</span><span class="n">anchor_x</span><span class="p">,</span> <span class="n">child</span><span class="o">.</span><span class="n">anchor_y</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>

            <span class="c1">#現在のカーソル位置x,yに対応する変換を求める</span>
            <span class="n">trans1</span> <span class="o">=</span> <span class="n">crt</span><span class="o">.</span><span class="n">Translate</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="n">POS</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">y</span><span class="o">=</span><span class="n">POS</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span> <span class="c1">#への配置変換</span>
            <span class="k">if</span> <span class="kc">True</span><span class="p">:</span> 
                <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;@debug:pack:align=</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">align</span><span class="si">}</span><span class="s1"> =&gt; trans1=</span><span class="si">{</span><span class="n">trans1</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>
            
            <span class="c1">#子の包含矩形の計算と更新</span>
            <span class="n">child_box</span> <span class="o">=</span> <span class="n">crt</span><span class="o">.</span><span class="n">box_apply_trans</span><span class="p">(</span><span class="n">child_box</span><span class="p">,</span> <span class="n">trans</span><span class="o">=</span><span class="n">trans1</span><span class="p">)</span>
            
            <span class="c1">#親の包含矩形の更新</span>
            <span class="n">boxes</span> <span class="o">=</span> <span class="n">crt</span><span class="o">.</span><span class="n">box_union</span><span class="p">(</span><span class="n">boxes</span><span class="p">,</span> <span class="n">child_box</span><span class="p">)</span>
            <span class="k">if</span> <span class="kc">True</span><span class="p">:</span> <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;@debug:pack:update:</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">myinfo</span><span class="p">()</span><span class="si">}</span><span class="s1"> child=</span><span class="si">{</span><span class="n">child_box</span><span class="si">}</span><span class="s1"> =&gt; self=</span><span class="si">{</span><span class="n">boxes</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>

            <span class="c1">#新しい子リストに子を追加する</span>
            <span class="n">com</span><span class="o">.</span><span class="n">ensure</span><span class="p">(</span><span class="n">child</span><span class="o">.</span><span class="n">ord_</span> <span class="o">==</span> <span class="nb">len</span><span class="p">(</span><span class="n">children_new_</span><span class="p">))</span> <span class="c1">#ord_の検査</span>
            <span class="n">children_new_</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="n">trans1</span><span class="p">,</span> <span class="n">child</span><span class="p">))</span> <span class="c1">#子リスト</span>

            <span class="c1">#次の配置位置を求める</span>
            <span class="c1"># if (not is_expand_mode) and self.pack: ## 子を詰め込む</span>
            <span class="c1">#     INC[0], INC[1] = crt.box_shape(child_box)</span>
            <span class="k">if</span> <span class="p">(</span><span class="ow">not</span> <span class="n">is_expand_mode</span><span class="p">):</span> <span class="c1">## 子を詰め込む</span>
                <span class="n">INC</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">INC</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="n">crt</span><span class="o">.</span><span class="n">box_shape</span><span class="p">(</span><span class="n">child_box</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">pass</span> 
            <span class="n">POS</span><span class="p">[</span><span class="n">AX_PRI</span><span class="p">]</span> <span class="o">+=</span> <span class="n">INC</span><span class="p">[</span><span class="n">AX_PRI</span><span class="p">]</span> <span class="o">+</span> <span class="n">MAR</span><span class="p">[</span><span class="n">AX_PRI</span><span class="p">]</span> <span class="c1">#次の配置位置</span>
            <span class="k">if</span> <span class="kc">True</span><span class="p">:</span> <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;@debug:pack:align=</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">align</span><span class="si">}</span><span class="s1"> pos=</span><span class="si">{</span><span class="n">POS</span><span class="p">[</span><span class="n">AX_PRI</span><span class="p">]</span><span class="si">}</span><span class="s1"> + inc=</span><span class="si">{</span><span class="n">INC</span><span class="p">[</span><span class="n">AX_PRI</span><span class="p">]</span><span class="si">}</span><span class="s1"> + mg=</span><span class="si">{</span><span class="n">MAR</span><span class="p">[</span><span class="n">AX_PRI</span><span class="p">]</span><span class="si">}</span><span class="s1"> =&gt; pos_new=</span><span class="si">{</span><span class="n">POS</span><span class="p">[</span><span class="n">AX_PRI</span><span class="p">]</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>
        
        <span class="c1">#exp 自身の情報を更新</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">children_</span>  <span class="o">=</span> <span class="n">children_new_</span> <span class="c1">#子リストの更新</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">trans_self</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">box_self</span>   <span class="o">=</span> <span class="n">boxes</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">pack_done</span> <span class="o">=</span> <span class="kc">True</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">box_self</span>
        
    <span class="k">pass</span> <span class="c1">##class PackerBoard</span></div>
        

<span class="c1">##======</span>
<span class="c1">## 描画演算オブジェクト</span>
<span class="c1">##======</span>

<div class="viewcode-block" id="DrawCommandBase"><a class="viewcode-back" href="../../board.html#board.cboard.DrawCommandBase">[ドキュメント]</a><span class="k">class</span> <span class="nc">DrawCommandBase</span><span class="p">(</span><span class="n">Board</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;描画演算オブジェクトの基底クラス．Boardクラスのサブクラス．</span>

<span class="sd">    Args: </span>
<span class="sd">         cmd (str) : 命令の名前の文字列．default=None. </span>

<span class="sd">         **kwargs (dict) : 上位コマンドに渡すオプション引数．</span>

<span class="sd">    Attributes: </span>
<span class="sd">         cmd (str) : 命令の名前の文字列．default=None. </span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span>
                 <span class="n">cmd</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="c1">#命令の名前</span>
                 <span class="o">**</span><span class="n">kwargs</span>  <span class="c1">#命令の引数</span>
                 <span class="p">):</span>
        <span class="n">verbose</span> <span class="o">=</span> <span class="n">kw</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">kwargs</span><span class="p">,</span> <span class="n">key</span><span class="o">=</span><span class="s1">&#39;verbose&#39;</span><span class="p">)</span>
        <span class="n">com</span><span class="o">.</span><span class="n">ensure</span><span class="p">(</span><span class="n">cmd</span><span class="o">!=</span><span class="kc">None</span><span class="p">,</span> <span class="sa">f</span><span class="s1">&#39;DrawCommandBase(): cmd must not be None!&#39;</span><span class="p">)</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">verbose</span><span class="p">:</span> 
            <span class="bp">self</span><span class="o">.</span><span class="n">repo</span><span class="p">(</span><span class="n">msg</span><span class="o">=</span><span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">myinfo</span><span class="p">()</span><span class="si">}</span><span class="s1">(): cmd=</span><span class="si">{</span> <span class="n">cmd</span> <span class="si">}</span><span class="s1"> kwargs=</span><span class="si">{</span> <span class="n">kwargs</span> <span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>
        <span class="n">com</span><span class="o">.</span><span class="n">ensure</span><span class="p">(</span><span class="nb">type</span><span class="p">(</span><span class="n">cmd</span><span class="p">)</span> <span class="ow">is</span> <span class="nb">str</span><span class="p">,</span> <span class="sa">f</span><span class="s1">&#39;cmd=</span><span class="si">{</span><span class="n">cmd</span><span class="si">}</span><span class="s1"> must be str!&#39;</span><span class="p">)</span>

        <span class="c1">#命令を格納する</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">cmd</span>     <span class="o">=</span> <span class="n">cmd</span> 
        <span class="c1"># self.kwargs  = kwargs  #exp</span>
        <span class="k">return</span>


    <span class="c1">#Override </span>
<div class="viewcode-block" id="DrawCommandBase.draw_me"><a class="viewcode-back" href="../../board.html#board.cboard.DrawCommandBase.draw_me">[ドキュメント]</a>    <span class="k">def</span> <span class="nf">draw_me</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">cr</span><span class="p">):</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">verbose</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">repo</span><span class="p">(</span><span class="n">isChild</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">msg</span><span class="o">=</span><span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">myinfo</span><span class="p">()</span><span class="si">}</span><span class="s1">.draw_me(): </span><span class="si">{</span> <span class="bp">self</span><span class="o">.</span><span class="n">vars</span><span class="p">()</span> <span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>
        <span class="n">kwargs1</span> <span class="o">=</span> <span class="n">kw</span><span class="o">.</span><span class="n">extract</span><span class="p">(</span><span class="n">kwargs</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">kwargs</span><span class="p">,</span> <span class="n">keys</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;x&#39;</span><span class="p">,</span> <span class="s1">&#39;y&#39;</span><span class="p">,</span> <span class="s1">&#39;width&#39;</span><span class="p">,</span> <span class="s1">&#39;height&#39;</span><span class="p">,</span> <span class="s1">&#39;fill&#39;</span><span class="p">,</span> <span class="s1">&#39;source_rgb&#39;</span><span class="p">,</span> <span class="s1">&#39;edge_rgb&#39;</span><span class="p">,</span> <span class="s1">&#39;line_width&#39;</span><span class="p">])</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">draw_me_impl</span><span class="p">(</span><span class="n">cr</span><span class="p">)</span>
        <span class="k">return</span> </div>

    <span class="c1">#Override: To be implemented </span>
<div class="viewcode-block" id="DrawCommandBase.draw_me_impl"><a class="viewcode-back" href="../../board.html#board.cboard.DrawCommandBase.draw_me_impl">[ドキュメント]</a>    <span class="k">def</span> <span class="nf">draw_me_impl</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">cr</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;To be implemented </span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> </div>
        
    <span class="c1">#Override </span>
<div class="viewcode-block" id="DrawCommandBase.get_kwargs"><a class="viewcode-back" href="../../board.html#board.cboard.DrawCommandBase.get_kwargs">[ドキュメント]</a>    <span class="k">def</span> <span class="nf">get_kwargs</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">kwargs</span></div>
    <span class="k">pass</span></div>

<div class="viewcode-block" id="DrawCommandTemplate"><a class="viewcode-back" href="../../board.html#board.cboard.DrawCommandTemplate">[ドキュメント]</a><span class="k">class</span> <span class="nc">DrawCommandTemplate</span><span class="p">(</span><span class="n">DrawCommandBase</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;描画演算オブジェクトのクラス．DrawCommandBaseクラスのサブクラス．</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">cmd</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="n">cmd</span><span class="o">=</span><span class="n">cmd</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
        <span class="k">return</span> </div>

<span class="c1">#======</span>
<span class="c1"># 単一図形描画</span>
<span class="c1">#======</span>
<span class="n">CFSIZE</span><span class="o">=</span><span class="mi">4</span>
<div class="viewcode-block" id="DrawRectangle"><a class="viewcode-back" href="../../board.html#board.cboard.DrawRectangle">[ドキュメント]</a><span class="k">class</span> <span class="nc">DrawRectangle</span><span class="p">(</span><span class="n">DrawCommandBase</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;描画演算オブジェクトのクラス．DrawCommandBaseクラスのサブクラス．</span>

<span class="sd">    Args: </span>
<span class="sd">          x (float) : default=0.0. </span>

<span class="sd">          y (float) : default=0.0. </span>

<span class="sd">          **kwargs (dict) : 上位コマンドに渡すオプション引数．</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;x&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">kw</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">kwargs</span><span class="p">,</span> <span class="s1">&#39;x&#39;</span><span class="p">,</span> <span class="n">default</span><span class="o">=</span><span class="mf">0.0</span><span class="p">)</span>
        <span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;y&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">kw</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">kwargs</span><span class="p">,</span> <span class="s1">&#39;y&#39;</span><span class="p">,</span> <span class="n">default</span><span class="o">=</span><span class="mf">0.0</span><span class="p">)</span>        
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="n">cmd</span><span class="o">=</span><span class="s1">&#39;rectangle&#39;</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
        <span class="k">return</span> 

    <span class="c1">#Override </span>
<div class="viewcode-block" id="DrawRectangle.arrange_me"><a class="viewcode-back" href="../../board.html#board.cboard.DrawRectangle.arrange_me">[ドキュメント]</a>    <span class="k">def</span> <span class="nf">arrange_me</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">x</span> <span class="o">=</span> <span class="n">kw</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">kwargs</span><span class="p">,</span> <span class="s1">&#39;x&#39;</span><span class="p">,</span> <span class="n">required</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
        <span class="n">y</span> <span class="o">=</span> <span class="n">kw</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">kwargs</span><span class="p">,</span> <span class="s1">&#39;y&#39;</span><span class="p">,</span> <span class="n">required</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
        <span class="n">width</span> <span class="o">=</span> <span class="n">kw</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">kwargs</span><span class="p">,</span> <span class="s1">&#39;width&#39;</span><span class="p">,</span> <span class="n">required</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
        <span class="n">height</span> <span class="o">=</span> <span class="n">kw</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">kwargs</span><span class="p">,</span> <span class="s1">&#39;height&#39;</span><span class="p">,</span> <span class="n">required</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
        <span class="n">box</span> <span class="o">=</span> <span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">x</span><span class="o">+</span><span class="n">width</span><span class="p">,</span> <span class="n">y</span><span class="o">+</span><span class="n">height</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">box</span> </div>
        
    <span class="c1">#Override </span>
<div class="viewcode-block" id="DrawRectangle.draw_me_impl"><a class="viewcode-back" href="../../board.html#board.cboard.DrawRectangle.draw_me_impl">[ドキュメント]</a>    <span class="k">def</span> <span class="nf">draw_me_impl</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">cr</span><span class="p">):</span>
        <span class="n">crt</span><span class="o">.</span><span class="n">cr_rectangle</span><span class="p">(</span><span class="n">context</span><span class="o">=</span><span class="n">cr</span><span class="p">,</span> <span class="o">**</span><span class="bp">self</span><span class="o">.</span><span class="n">kwargs</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">kw</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">kwargs</span><span class="p">,</span> <span class="s1">&#39;debug&#39;</span><span class="p">,</span> <span class="n">default</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span> 
            <span class="n">crt</span><span class="o">.</span><span class="n">cr_text</span><span class="p">(</span><span class="n">context</span><span class="o">=</span><span class="n">cr</span><span class="p">,</span> <span class="n">ox</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">oy</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span>
                        <span class="n">msg</span><span class="o">=</span><span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">trans_self</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">,</span> <span class="n">fsize</span><span class="o">=</span><span class="n">CFSIZE</span><span class="p">)</span> <span class="c1">#debug</span>
            <span class="n">crt</span><span class="o">.</span><span class="n">cr_text</span><span class="p">(</span><span class="n">context</span><span class="o">=</span><span class="n">cr</span><span class="p">,</span> <span class="n">ox</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">oy</span><span class="o">=</span><span class="n">CFSIZE</span><span class="p">,</span> <span class="n">fsize</span><span class="o">=</span><span class="n">CFSIZE</span><span class="p">,</span>
                        <span class="n">msg</span><span class="o">=</span><span class="sa">f</span><span class="s1">&#39;ratio=</span><span class="si">{</span> <span class="bp">self</span><span class="o">.</span><span class="n">anchor_ratio_x</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">anchor_ratio_y</span> <span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span> <span class="c1">#debug</span>
            <span class="n">crt</span><span class="o">.</span><span class="n">cr_text</span><span class="p">(</span><span class="n">context</span><span class="o">=</span><span class="n">cr</span><span class="p">,</span> <span class="n">ox</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">oy</span><span class="o">=</span><span class="mi">2</span><span class="o">*</span><span class="n">CFSIZE</span><span class="p">,</span> <span class="n">fsize</span><span class="o">=</span><span class="n">CFSIZE</span><span class="p">,</span>
                        <span class="n">msg</span><span class="o">=</span><span class="sa">f</span><span class="s1">&#39;box_=</span><span class="si">{</span> <span class="bp">self</span><span class="o">.</span><span class="n">box_self</span> <span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span> <span class="c1">#debug</span>
        <span class="k">if</span> <span class="n">kw</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">kwargs</span><span class="p">,</span> <span class="s1">&#39;show_native_origin&#39;</span><span class="p">,</span> <span class="n">default</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span> 
            <span class="n">crt</span><span class="o">.</span><span class="n">cr_draw_marker_cross</span><span class="p">(</span><span class="n">context</span><span class="o">=</span><span class="n">cr</span><span class="p">,</span> <span class="n">x</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">y</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> 
                                     <span class="n">linewidth</span><span class="o">=</span><span class="mf">0.5</span><span class="p">,</span> <span class="n">angle</span><span class="o">=</span><span class="n">math</span><span class="o">.</span><span class="n">pi</span><span class="o">*</span><span class="mf">0.0</span><span class="p">,</span> 
                                     <span class="n">rgb</span><span class="o">=</span><span class="n">crt</span><span class="o">.</span><span class="n">cr_add_alpha</span><span class="p">(</span><span class="n">crt</span><span class="o">.</span><span class="n">MYCOL</span><span class="p">[</span><span class="s1">&#39;blue&#39;</span><span class="p">],</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.5</span><span class="p">))</span>
        <span class="k">return</span> </div></div>

<div class="viewcode-block" id="DrawCircle"><a class="viewcode-back" href="../../board.html#board.cboard.DrawCircle">[ドキュメント]</a><span class="k">class</span> <span class="nc">DrawCircle</span><span class="p">(</span><span class="n">DrawCommandBase</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;描画演算オブジェクトのクラス．DrawCommandBaseクラスのサブクラス．</span>

<span class="sd">    Args: </span>
<span class="sd">          x (float) : 円の中心位置のx座標．default=0.0. </span>

<span class="sd">          y (float) : 円の中心位置のy座標．default=0.0. </span>

<span class="sd">          r (float) : 円の半径．必須．</span>

<span class="sd">          **kwargs (dict) : 上位コマンドに渡すオプション引数．</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;x&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">kw</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">kwargs</span><span class="p">,</span> <span class="s1">&#39;x&#39;</span><span class="p">,</span> <span class="n">default</span><span class="o">=</span><span class="mf">0.0</span><span class="p">)</span>
        <span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;y&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">kw</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">kwargs</span><span class="p">,</span> <span class="s1">&#39;y&#39;</span><span class="p">,</span> <span class="n">default</span><span class="o">=</span><span class="mf">0.0</span><span class="p">)</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="n">cmd</span><span class="o">=</span><span class="s1">&#39;circle&#39;</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
        <span class="k">return</span> 

    <span class="c1">#Override </span>
<div class="viewcode-block" id="DrawCircle.arrange_me"><a class="viewcode-back" href="../../board.html#board.cboard.DrawCircle.arrange_me">[ドキュメント]</a>    <span class="k">def</span> <span class="nf">arrange_me</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">x</span> <span class="o">=</span> <span class="n">kw</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">kwargs</span><span class="p">,</span> <span class="s1">&#39;x&#39;</span><span class="p">,</span> <span class="n">required</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
        <span class="n">y</span> <span class="o">=</span> <span class="n">kw</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">kwargs</span><span class="p">,</span> <span class="s1">&#39;y&#39;</span><span class="p">,</span> <span class="n">required</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
        <span class="n">r</span> <span class="o">=</span> <span class="n">kw</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">kwargs</span><span class="p">,</span> <span class="s1">&#39;r&#39;</span><span class="p">,</span> <span class="n">required</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
        <span class="n">box</span> <span class="o">=</span> <span class="p">(</span><span class="n">x</span><span class="o">-</span><span class="n">r</span><span class="p">,</span> <span class="n">y</span><span class="o">-</span><span class="n">r</span><span class="p">,</span> <span class="n">x</span><span class="o">+</span><span class="n">r</span><span class="p">,</span> <span class="n">y</span><span class="o">+</span><span class="n">r</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">box</span> </div>
        
    <span class="c1">#Override </span>
<div class="viewcode-block" id="DrawCircle.draw_me_impl"><a class="viewcode-back" href="../../board.html#board.cboard.DrawCircle.draw_me_impl">[ドキュメント]</a>    <span class="k">def</span> <span class="nf">draw_me_impl</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">cr</span><span class="p">):</span>
        <span class="c1"># Note: self.kwargs contains keys &#39;x&#39;, &#39;y&#39;, &#39;r&#39;. </span>
        <span class="n">crt</span><span class="o">.</span><span class="n">cr_circle</span><span class="p">(</span><span class="n">context</span><span class="o">=</span><span class="n">cr</span><span class="p">,</span> <span class="o">**</span><span class="bp">self</span><span class="o">.</span><span class="n">kwargs</span><span class="p">)</span> 
        <span class="k">if</span> <span class="n">kw</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">kwargs</span><span class="p">,</span> <span class="s1">&#39;debug&#39;</span><span class="p">,</span> <span class="n">default</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span> 
            <span class="n">crt</span><span class="o">.</span><span class="n">cr_text</span><span class="p">(</span><span class="n">context</span><span class="o">=</span><span class="n">cr</span><span class="p">,</span> <span class="n">ox</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">oy</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span>
                        <span class="n">msg</span><span class="o">=</span><span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">trans_self</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">,</span> <span class="n">fsize</span><span class="o">=</span><span class="n">CFSIZE</span><span class="p">)</span><span class="c1">#debug</span>
            <span class="n">crt</span><span class="o">.</span><span class="n">cr_text</span><span class="p">(</span><span class="n">context</span><span class="o">=</span><span class="n">cr</span><span class="p">,</span> <span class="n">ox</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">oy</span><span class="o">=</span><span class="n">CFSIZE</span><span class="p">,</span> <span class="n">fsize</span><span class="o">=</span><span class="n">CFSIZE</span><span class="p">,</span>
                        <span class="n">msg</span><span class="o">=</span><span class="sa">f</span><span class="s1">&#39;ratio=</span><span class="si">{</span> <span class="bp">self</span><span class="o">.</span><span class="n">anchor_ratio_x</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">anchor_ratio_y</span> <span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span> <span class="c1">#debug</span>
            <span class="n">crt</span><span class="o">.</span><span class="n">cr_text</span><span class="p">(</span><span class="n">context</span><span class="o">=</span><span class="n">cr</span><span class="p">,</span> <span class="n">ox</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">oy</span><span class="o">=</span><span class="mi">2</span><span class="o">*</span><span class="n">CFSIZE</span><span class="p">,</span> <span class="n">fsize</span><span class="o">=</span><span class="n">CFSIZE</span><span class="p">,</span>
                        <span class="n">msg</span><span class="o">=</span><span class="sa">f</span><span class="s1">&#39;box_=</span><span class="si">{</span> <span class="bp">self</span><span class="o">.</span><span class="n">box_self</span> <span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span> <span class="c1">#debug</span>
        <span class="k">if</span> <span class="n">kw</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">kwargs</span><span class="p">,</span> <span class="s1">&#39;show_native_origin&#39;</span><span class="p">,</span> <span class="n">default</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span> 
            <span class="n">crt</span><span class="o">.</span><span class="n">cr_draw_marker_cross</span><span class="p">(</span><span class="n">context</span><span class="o">=</span><span class="n">cr</span><span class="p">,</span> <span class="n">x</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">y</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> 
                                     <span class="n">linewidth</span><span class="o">=</span><span class="mf">0.5</span><span class="p">,</span> <span class="n">angle</span><span class="o">=</span><span class="n">math</span><span class="o">.</span><span class="n">pi</span><span class="o">*</span><span class="mf">0.0</span><span class="p">,</span> 
                                     <span class="n">rgb</span><span class="o">=</span><span class="n">crt</span><span class="o">.</span><span class="n">cr_add_alpha</span><span class="p">(</span><span class="n">crt</span><span class="o">.</span><span class="n">MYCOL</span><span class="p">[</span><span class="s1">&#39;blue&#39;</span><span class="p">],</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.5</span><span class="p">))</span>
        <span class="k">return</span> </div></div>

<span class="c1"># #未使用</span>
<span class="c1"># class DrawArc(DrawCommandBase):</span>
<span class="c1">#     &quot;&quot;&quot;描画演算オブジェクトのクラス．DrawCommandBaseクラスのサブクラス．</span>
<span class="c1">#     &quot;&quot;&quot;</span>
<span class="c1">#     def __init__(self, **kwargs):</span>
<span class="c1">#         super().__init__(cmd=&#39;arc&#39;, **kwargs)</span>
<span class="c1">#         return </span>

<span class="c1">#     #Override </span>
<span class="c1">#     def arrange_me(self):</span>
<span class="c1">#         box = (0, 0)</span>
<span class="c1">#         return box </span>
        
<span class="c1">#     #Override </span>
<span class="c1">#     def draw_me_impl(self, cr):</span>
<span class="c1">#         crt.cr_arc(context=cr, **self.kwargs) </span>
<span class="c1">#         return </span>

<span class="c1">#======</span>
<span class="c1"># 線分列の描画</span>
<span class="c1">#======</span>

<span class="c1">#constants</span>
<span class="n">CMD_MOVE</span> <span class="o">=</span> <span class="mi">0</span>
<span class="n">CMD_LINE</span> <span class="o">=</span> <span class="mi">1</span>

<div class="viewcode-block" id="DrawPolyLines"><a class="viewcode-back" href="../../board.html#board.cboard.DrawPolyLines">[ドキュメント]</a><span class="k">class</span> <span class="nc">DrawPolyLines</span><span class="p">(</span><span class="n">DrawCommandBase</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;描画演算オブジェクトのクラス．DrawCommandBaseクラスのサブクラス．</span>

<span class="sd">    Args: </span>
<span class="sd">          **kwargs (dict) : 上位コマンドに渡すオプション引数．</span>

<span class="sd">    Examples:: </span>
<span class="sd">    </span>
<span class="sd">                #サイズが4x4の十字型(X)を書く．</span>
<span class="sd">              	P = DrawPolyLine()</span>
<span class="sd">        	P.move_to(0.0, 0.0)</span>
<span class="sd">        	P.line_to(4.0, 4.0)</span>
<span class="sd">        	P.move_to(0.0, 4.0)</span>
<span class="sd">        	P.line_to(4.0, 0.0)</span>
<span class="sd">    &quot;&quot;&quot;</span>
    
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="n">cmd</span><span class="o">=</span><span class="s1">&#39;polylines&#39;</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">CMDS</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">return</span> 

    <span class="c1">#Override </span>
<div class="viewcode-block" id="DrawPolyLines.arrange_me"><a class="viewcode-back" href="../../board.html#board.cboard.DrawPolyLines.arrange_me">[ドキュメント]</a>    <span class="k">def</span> <span class="nf">arrange_me</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="c1">#命令全ての包含長方形を計算する</span>
        <span class="n">boxes</span> <span class="o">=</span> <span class="n">EMPTY_RECT</span>
        <span class="k">for</span> <span class="n">idx</span><span class="p">,</span> <span class="n">pair</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">CMDS</span><span class="p">):</span>
            <span class="n">cmd</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">_</span> <span class="o">=</span> <span class="n">pair</span> <span class="c1">#分解</span>
            <span class="n">boxes</span> <span class="o">=</span> <span class="n">crt</span><span class="o">.</span><span class="n">box_union</span><span class="p">(</span><span class="n">boxes</span><span class="p">,</span> <span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">))</span>
        <span class="k">if</span> <span class="kc">True</span><span class="p">:</span> <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;@debug:polyline: boxes=</span><span class="si">{</span><span class="n">boxes</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">boxes</span> </div>

    <span class="c1">#Override </span>
<div class="viewcode-block" id="DrawPolyLines.draw_me_impl"><a class="viewcode-back" href="../../board.html#board.cboard.DrawPolyLines.draw_me_impl">[ドキュメント]</a>    <span class="k">def</span> <span class="nf">draw_me_impl</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">cr</span><span class="p">):</span>
        <span class="n">crt</span><span class="o">.</span><span class="n">cr_set_context_parameters</span><span class="p">(</span><span class="n">context</span><span class="o">=</span><span class="n">cr</span><span class="p">,</span> <span class="o">**</span><span class="bp">self</span><span class="o">.</span><span class="n">kwargs</span><span class="p">)</span>
        <span class="n">x_last</span><span class="p">,</span> <span class="n">y_last</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="kc">None</span> 
        <span class="k">for</span> <span class="n">idx</span><span class="p">,</span> <span class="n">pair</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">CMDS</span><span class="p">):</span>
            <span class="n">cmd</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">has_arrow</span> <span class="o">=</span> <span class="n">pair</span> <span class="c1">#分解</span>
            <span class="k">if</span> <span class="n">cmd</span><span class="o">==</span><span class="n">CMD_MOVE</span><span class="p">:</span>
                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">verbose</span><span class="p">:</span>
                    <span class="n">kwargs</span><span class="o">=</span><span class="p">{</span> <span class="s1">&#39;x&#39;</span><span class="p">:</span><span class="n">x</span><span class="p">,</span> <span class="s1">&#39;y&#39;</span><span class="p">:</span> <span class="n">y</span><span class="p">,</span> <span class="p">}</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">repo</span><span class="p">(</span><span class="n">isChild</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">msg</span><span class="o">=</span><span class="sa">f</span><span class="s1">&#39;@debug: cr_move_to: </span><span class="si">{</span> <span class="n">kwargs</span> <span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>
                <span class="n">crt</span><span class="o">.</span><span class="n">cr_move_to</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">context</span><span class="o">=</span><span class="n">cr</span><span class="p">)</span>
            <span class="k">elif</span> <span class="n">cmd</span><span class="o">==</span><span class="n">CMD_LINE</span><span class="p">:</span>
                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">verbose</span><span class="p">:</span>
                    <span class="n">kwargs</span><span class="o">=</span><span class="p">{</span> <span class="s1">&#39;x&#39;</span><span class="p">:</span><span class="n">x</span><span class="p">,</span> <span class="s1">&#39;y&#39;</span><span class="p">:</span> <span class="n">y</span><span class="p">,</span> <span class="s1">&#39;has_arrow&#39;</span><span class="p">:</span> <span class="n">has_arrow</span><span class="p">,</span>
                             <span class="s1">&#39;x_last&#39;</span><span class="p">:</span> <span class="n">x_last</span><span class="p">,</span> <span class="s1">&#39;y_last&#39;</span><span class="p">:</span> <span class="n">y_last</span><span class="p">,</span> <span class="p">}</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">repo</span><span class="p">(</span><span class="n">isChild</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">msg</span><span class="o">=</span><span class="sa">f</span><span class="s1">&#39;@debug: cr_line_to: </span><span class="si">{</span> <span class="n">kwargs</span> <span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>
                <span class="k">if</span> <span class="n">x_last</span> <span class="o">!=</span> <span class="kc">None</span> <span class="ow">and</span> <span class="n">y_last</span> <span class="o">!=</span> <span class="kc">None</span><span class="p">:</span> 
                    <span class="n">crt</span><span class="o">.</span><span class="n">cr_line_to</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">context</span><span class="o">=</span><span class="n">cr</span><span class="p">,</span> 
                                   <span class="n">x_last</span><span class="o">=</span><span class="n">x_last</span><span class="p">,</span> <span class="n">y_last</span><span class="o">=</span><span class="n">y_last</span><span class="p">,</span>
                                   <span class="n">has_arrow</span><span class="o">=</span><span class="n">has_arrow</span><span class="p">,</span>
                                   <span class="o">**</span><span class="bp">self</span><span class="o">.</span><span class="n">kwargs</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">com</span><span class="o">.</span><span class="n">panic</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;PolyLines.draw_me_impl: no such cmd=</span><span class="si">{</span><span class="n">cmd</span><span class="si">}</span><span class="s1">!&#39;</span><span class="p">)</span>
            <span class="n">x_last</span><span class="p">,</span> <span class="n">y_last</span> <span class="o">=</span> <span class="n">x</span><span class="p">,</span> <span class="n">y</span> 
            <span class="k">pass</span>
        <span class="n">crt</span><span class="o">.</span><span class="n">cr_process_stroke_or_fill</span><span class="p">(</span><span class="n">context</span><span class="o">=</span><span class="n">cr</span><span class="p">,</span> <span class="o">**</span><span class="bp">self</span><span class="o">.</span><span class="n">kwargs</span><span class="p">)</span>
        <span class="k">return</span></div>

<div class="viewcode-block" id="DrawPolyLines.move_to"><a class="viewcode-back" href="../../board.html#board.cboard.DrawPolyLines.move_to">[ドキュメント]</a>    <span class="k">def</span> <span class="nf">move_to</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;ペンを位置`(x,y)`に移動する．直線は引かない．</span>
<span class="sd">        Args: </span>

<span class="sd">              x (float) : x- and y-coodinates</span>

<span class="sd">              y (float) : x- and y-coodinates</span>

<span class="sd">        Returns:</span>
<span class="sd">              (Board) : 自分自身．いわゆる&#39;cascade object call interface&#39; のため．</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">has_arrow</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">CMDS</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="n">CMD_MOVE</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">has_arrow</span><span class="p">))</span>
        <span class="k">return</span> <span class="bp">self</span> <span class="c1">#for cascade object interface </span></div>
    
<div class="viewcode-block" id="DrawPolyLines.line_to"><a class="viewcode-back" href="../../board.html#board.cboard.DrawPolyLines.line_to">[ドキュメント]</a>    <span class="k">def</span> <span class="nf">line_to</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">has_arrow</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;ペンを現在位置から目標位置`(x,y)`まで移動して，直線を引く．</span>

<span class="sd">        Args: </span>

<span class="sd">              x (float) : x- and y-coodinates</span>

<span class="sd">              y (float) : x- and y-coodinates</span>

<span class="sd">        Returns:</span>
<span class="sd">              (Board) : 自分自身．いわゆる&#39;cascade object call interface&#39; のため．</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">CMDS</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="n">CMD_LINE</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">has_arrow</span><span class="p">))</span> 
        <span class="k">return</span> <span class="bp">self</span> <span class="c1">#for cascade object interface </span></div>
    
    <span class="k">pass</span> </div>

<div class="viewcode-block" id="DrawMarkerCross"><a class="viewcode-back" href="../../board.html#board.cboard.DrawMarkerCross">[ドキュメント]</a><span class="k">class</span> <span class="nc">DrawMarkerCross</span><span class="p">(</span><span class="n">DrawPolyLines</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;原点 (0,0) を中心とした×印（Cross）を書く．</span>

<span class="sd">    Args: </span>
<span class="sd">         ticklen (float) : ×印の交差辺の長さ. default=4.0. </span>

<span class="sd">         line_width (float) : ×印の交差辺の線幅．default=0.75．</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="c1"># kwargs[&#39;x&#39;] = kw.get(kwargs, &#39;x&#39;, default=0.0)</span>
        <span class="c1"># kwargs[&#39;y&#39;] = kw.get(kwargs, &#39;y&#39;, default=0.0)        </span>
        <span class="n">ticklen</span> <span class="o">=</span> <span class="n">kw</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">kwargs</span><span class="p">,</span> <span class="s1">&#39;ticklen&#39;</span><span class="p">,</span> <span class="n">default</span><span class="o">=</span><span class="mf">4.0</span><span class="p">)</span>
        <span class="n">linewidth</span> <span class="o">=</span> <span class="n">kw</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">kwargs</span><span class="p">,</span> <span class="n">key</span><span class="o">=</span><span class="s1">&#39;linewidth&#39;</span><span class="p">,</span>
                           <span class="n">altkeys</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;line_width&#39;</span><span class="p">,</span> <span class="s1">&#39;pen_width&#39;</span><span class="p">],</span> <span class="n">default</span><span class="o">=</span><span class="mf">0.75</span><span class="p">)</span>
        <span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;linewidth&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">linewidth</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
        <span class="c1"># clen = 5</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">move_to</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">line_to</span><span class="p">(</span><span class="n">ticklen</span><span class="o">*</span><span class="mf">1.0</span><span class="p">,</span> <span class="n">ticklen</span><span class="o">*</span><span class="mf">0.0</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">move_to</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">line_to</span><span class="p">(</span><span class="n">ticklen</span><span class="o">*</span><span class="p">(</span><span class="o">-</span><span class="mf">1.0</span><span class="p">),</span> <span class="n">ticklen</span><span class="o">*</span><span class="mf">0.0</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">move_to</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">line_to</span><span class="p">(</span><span class="n">ticklen</span><span class="o">*</span><span class="mf">0.0</span><span class="p">,</span> <span class="n">ticklen</span><span class="o">*</span><span class="mf">1.0</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">move_to</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">line_to</span><span class="p">(</span><span class="n">ticklen</span><span class="o">*</span><span class="mf">0.0</span><span class="p">,</span> <span class="n">ticklen</span><span class="o">*</span><span class="p">(</span><span class="o">-</span><span class="mf">1.0</span><span class="p">))</span>
        <span class="k">return</span> </div>




<span class="c1">#======</span>
<span class="c1"># 関数終わり</span>
<span class="c1">#======</span>

<span class="c1"># ## メイン文</span>
<span class="c1"># if __name__ == &#39;__main__&#39;:</span>
<span class="c1">#     shape = (9,6)</span>
<span class="c1">#     reg = ImageBoard(ratio=128, shape=shape, xy = (0.5, 0.5))</span>
<span class="c1">#     print(&#39;reg: \n&#39;, vars(reg))</span>
    
<span class="c1">##EOF</span>

</pre></div>

           </div>
          </div>
          <footer>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright 2022, Hiroki Arimura, Hokkaido University.</p>
  </div>

  Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    provided by <a href="https://readthedocs.org">Read the Docs</a>.
   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>